<!DOCTYPE html><html lang="zn-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ggtree学习笔记 | 🧬小蓝哥的知识荒原🧬</title><meta name="keywords" content="R语言"><meta name="author" content="小蓝哥"><meta name="copyright" content="小蓝哥"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="写在前面Y叔的ggtree$^{[1]}$毫无疑问是当前绘制美化系统发育树（下文简称进化树）的最佳工具，一直想学习，">
<meta property="og:type" content="article">
<meta property="og:title" content="ggtree学习笔记">
<meta property="og:url" content="http://example.com/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="🧬小蓝哥的知识荒原🧬">
<meta property="og:description" content="写在前面Y叔的ggtree$^{[1]}$毫无疑问是当前绘制美化系统发育树（下文简称进化树）的最佳工具，一直想学习，">
<meta property="og:locale" content="zn_CN">
<meta property="og:image" content="http://example.com/img/cover/ggtree.png">
<meta property="article:published_time" content="2021-02-15T02:35:58.000Z">
<meta property="article:modified_time" content="2021-11-23T06:44:29.066Z">
<meta property="article:author" content="小蓝哥">
<meta property="article:tag" content="R语言">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/cover/ggtree.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: 小蓝哥","link":"Link: ","source":"Source: 🧬小蓝哥的知识荒原🧬","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ggtree学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-11-23 14:44:29'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/head.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">73</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">11</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">11</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/cover/ggtree.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">🧬小蓝哥的知识荒原🧬</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ggtree学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-02-15T02:35:58.000Z" title="Created 2021-02-15 10:35:58">2021-02-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-11-23T06:44:29.066Z" title="Updated 2021-11-23 14:44:29">2021-11-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/R%E8%AF%AD%E8%A8%80/">R语言</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">11k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>59min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ggtree学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>Y叔的<code>ggtree</code>$^{[1]}$毫无疑问是当前绘制美化系统发育树（下文简称<code>进化树</code>）的最佳工具，一直想学习，<span id="more"></span>但是都没有真真正正学习过，一是因为网上关于<code>gtree</code>的中文资源较少，另外一个原因是感觉到自己用不上，就没认真学习。春节在家，实在无聊，下定决心学一遍<code>ggtree</code>。下面的内容来自Y叔的博客$^{[2]}$，若有不当之处，恳请批评指正。</p>
<h1 id="关于进化树"><a href="#关于进化树" class="headerlink" title="关于进化树"></a>关于进化树</h1><h2 id="进化树怎么看"><a href="#进化树怎么看" class="headerlink" title="进化树怎么看"></a>进化树怎么看</h2><p>进化树展示的是进化关系，简单说就是亲缘关系，通常是使用物种的遗传序列（如DNA序列、氨基酸序列等）来构建的。进化树看起来和层次聚类很像，这两者有木有区别呢？Y叔在<code>统计之都</code>上的文章$^{[3]}$是这样描述的：</p>
<blockquote>
<p>层次聚类的侧重点在于分类，把距离近的聚在一起。而进化树的构建可以说也是一个聚类过程，但侧重点在于推测进化关系和进化距离 (evolutionary distance)。</p>
</blockquote>
<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.png" class="">

<p>上图展示的是典型的系统发育树。图中绿色、蓝色和红色的点都是<code>nodes</code>，也就是节点（个人理解），其中最外层绿色的点表示的是每个<code>sample</code>，这时绿色的点也叫<code>tips</code>；蓝色的点表示的是<code>父节点</code>，也就是从外往内两两<code>sample</code>的共有节点，可以理解成<code>祖先（ancestor）</code>，祖先之间还可以继续往上溯源，最终就汇集到红色的点，这个红色的点也就是<code>root</code>，需要注意的是有根树才具有<code>root</code>节点；横线叫做<code>分支(branches)</code>，这些横线表示的是进化变化（evolutionary changes），线的长短表示的是以时间或遗传变异为单位的进化变化。</p>
<h2 id="进化树数据格式"><a href="#进化树数据格式" class="headerlink" title="进化树数据格式"></a>进化树数据格式</h2><p>进化树的数据格式有多种，常见的有<code>Newick</code>、<code>NEXUS</code>及<code>Phylip</code>。</p>
<h3 id="Newick格式"><a href="#Newick格式" class="headerlink" title="Newick格式"></a>Newick格式</h3><p><code>Newick</code>格式是最常见的使用最广泛的进化树数据格式。</p>
<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2.png" class="">

<p>上图是一个标准的进化树图，其对应的<code>Newick</code>格式为：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((t2:<span class="number">0.04</span>,t1:<span class="number">0.34</span>):<span class="number">0.89</span>,(t5:<span class="number">0.37</span>,(t4:<span class="number">0.03</span>,t3:<span class="number">0.67</span>):<span class="number">0.9</span>):<span class="number">0.59</span>); </span><br></pre></td></tr></table></figure>

<p>数据格式和图是一一对应的，假如我们看图的时候是从外到内，那<code>t3</code>和<code>t4</code>是最近的，在数据中，<code>t3</code>和<code>t4</code>也是在一个括号里面的，数据的最小单位是一对<code>()</code>，就像剥洋葱那样顺着括号一层一层往外剥的时候，就能得到上图的那种样式。冒号后面对应的是横线上的“距离”，父节点的“距离”是两个“子节点”共有的，因此，需要表示“父节点”的“距离”时，需要将“距离”放在“子节点“的括号外。</p>
<h3 id="NEXUS格式"><a href="#NEXUS格式" class="headerlink" title="NEXUS格式"></a>NEXUS格式</h3><p><code>NEXUS</code>格式是<code>Newick</code>格式的拓展，以<code>blocks</code>为单位将进化树的元素分开。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#NEXUS</span></span><br><span class="line">[R-package APE, Wed Nov  <span class="number">9</span> <span class="number">11</span>:<span class="number">46</span>:<span class="number">32</span> <span class="number">2016</span>]</span><br><span class="line"></span><br><span class="line">BEGIN TAXA;</span><br><span class="line">    DIMENSIONS NTAX = <span class="number">5</span>;</span><br><span class="line">    TAXLABELS</span><br><span class="line">        t5</span><br><span class="line">        t4</span><br><span class="line">        t1</span><br><span class="line">        t2</span><br><span class="line">        t3</span><br><span class="line">    ;</span><br><span class="line">END;</span><br><span class="line">BEGIN TREES;</span><br><span class="line">    TRANSLATE</span><br><span class="line">        <span class="number">1</span>   t5,</span><br><span class="line">        <span class="number">2</span>   t4,</span><br><span class="line">        <span class="number">3</span>   t1,</span><br><span class="line">        <span class="number">4</span>   t2,</span><br><span class="line">        <span class="number">5</span>   t3</span><br><span class="line">    ;</span><br><span class="line">    TREE * UNTITLED = [&amp;R] (<span class="number">1</span>:<span class="number">0.89</span>,((<span class="number">2</span>:<span class="number">0.59</span>,<span class="number">3</span>:<span class="number">0.37</span>):<span class="number">0.34</span>,</span><br><span class="line">    (<span class="number">4</span>:<span class="number">0.03</span>,<span class="number">5</span>:<span class="number">0.67</span>):<span class="number">0.9</span>):<span class="number">0.04</span>);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<h3 id="其他格式"><a href="#其他格式" class="headerlink" title="其他格式"></a>其他格式</h3><p>进化树的存储格式还有很多种，更多请参照Y叔的博客$^{[4]}$。</p>
<h1 id="进化树数据处理"><a href="#进化树数据处理" class="headerlink" title="进化树数据处理"></a>进化树数据处理</h1><p>进化树数据可以使用<code>treeio</code>$^{[5]}$这个包进行合并等操作，然后可以将其他信息利用<code>tidytree</code>$^{[6]}$这个包将树文件转换成R里面常见的数据框格式，这种格式也可以再次转化成树文件，利用<code>ggtree</code>进行可视化。</p>
<h2 id="phylo对象"><a href="#phylo对象" class="headerlink" title="phylo对象"></a><code>phylo</code>对象</h2><p><code>phylo</code>格式是R包<code>ape</code>支持的格式，在R中的很多包都依赖于这种格式。<code>tidytree</code>中的函数<code>as_tibble</code>可以将<code>phylo</code>转换成数据框，此时的数据框是个<code>tbl_tree</code>对象。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">library(ggtree)</span><br><span class="line">library(ape)</span><br><span class="line"></span><br><span class="line">set.seed(<span class="number">2017</span>)</span><br><span class="line">tree &lt;- rtree(<span class="number">4</span>)</span><br><span class="line">tree</span><br></pre></td></tr></table></figure>

<p>此时得到的是<code>phylo</code>对象：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Phylogenetic tree with 4 tips and 3 internal nodes.</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Tip labels:</span></span><br><span class="line"><span class="comment">##   t4, t1, t3, t2</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Rooted; includes branch lengths.</span></span><br></pre></td></tr></table></figure>

<p>现在将其转化成数据框：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">library(tidytree)</span><br><span class="line">x &lt;- as_tibble(tree)</span><br><span class="line">x</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">## # A tibble: 7 x 4</span><br><span class="line">##   parent  node branch.length label</span><br><span class="line">##    &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt;</span><br><span class="line">## 1      5     1       0.435   t4   </span><br><span class="line">## 2      7     2       0.674   t1   </span><br><span class="line">## 3      7     3       0.00202 t3   </span><br><span class="line">## 4      6     4       0.0251  t2   </span><br><span class="line">## 5      5     5      NA       &lt;NA&gt; </span><br><span class="line">## 6      5     6       0.472   &lt;NA&gt; </span><br><span class="line">## 7      6     7       0.274   &lt;NA&gt;</span><br></pre></td></tr></table></figure>

<p>看图更直观：</p>
<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.png" class="">

<p>可以清楚地看到进化树的全部信息，包括父节点、节点、分支长度及<code>tips</code>的标签等。</p>
<p>使用<code>as.phylo(x)</code>就能将数据框转换成<code>phylo</code>:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">as.phylo(x)</span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Phylogenetic tree with 4 tips and 3 internal nodes.</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Tip labels:</span></span><br><span class="line"><span class="comment">##   t4, t1, t3, t2</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Rooted; includes branch lengths.</span></span><br></pre></td></tr></table></figure>

<p>如果此时我们需要添加信息的话，在原始文件上添加信息是比较麻烦的，但是可以团购先构建数据框，然后将两个数据框<code>join</code>在一起就可以了：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">d &lt;- tibble(label = paste0(<span class="string">&#x27;t&#x27;</span>, <span class="number">1</span>:<span class="number">4</span>),</span><br><span class="line">            trait = rnorm(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">y &lt;- full_join(x, d, by = <span class="string">&#x27;label&#x27;</span>)</span><br><span class="line">y</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/4.png" class="">

<h2 id="treedata对象"><a href="#treedata对象" class="headerlink" title="treedata对象"></a><code>treedata</code>对象</h2><p><code>tidytree</code>默认的格式是<code>treedata</code>，函数<code>as.treedata</code>可以将前面的数据框转换成<code>treedata</code>对象：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">as.treedata(y)</span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## &#x27;treedata&#x27; S4 object&#x27;.</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## ...@ phylo: </span></span><br><span class="line"><span class="comment">## Phylogenetic tree with 4 tips and 3 internal nodes.</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Tip labels:</span></span><br><span class="line"><span class="comment">##   t4, t1, t3, t2</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Rooted; includes branch lengths.</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## with the following features available:</span></span><br><span class="line"><span class="comment">##  &#x27;trait&#x27;.</span></span><br></pre></td></tr></table></figure>

<p>同样也可以通过<code>as_tibble</code>将<code>treedata</code>转换成数据框格式：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y %&gt;% as.treedata %&gt;% as_tibble</span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## # A tibble: 7 x 5</span></span><br><span class="line"><span class="comment">##   parent  node branch.length label  trait</span></span><br><span class="line"><span class="comment">##    &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;</span></span><br><span class="line"><span class="comment">## 1      5     1       0.435   t4     0.943</span></span><br><span class="line"><span class="comment">## 2      7     2       0.674   t1    -0.171</span></span><br><span class="line"><span class="comment">## 3      7     3       0.00202 t3     0.570</span></span><br><span class="line"><span class="comment">## 4      6     4       0.0251  t2    -0.283</span></span><br><span class="line"><span class="comment">## 5      5     5      NA       &lt;NA&gt;  NA    </span></span><br><span class="line"><span class="comment">## 6      5     6       0.472   &lt;NA&gt;  NA    </span></span><br><span class="line"><span class="comment">## 7      6     7       0.274   &lt;NA&gt;  NA</span></span><br></pre></td></tr></table></figure>

<h2 id="树文件融合"><a href="#树文件融合" class="headerlink" title="树文件融合"></a>树文件融合</h2><p><code>treeio</code>同的函数<code>merge_tree()</code>可以对多个树文件进行合并，原理是以<code>node/branches</code>为`key进行数据合并，如：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">library(treeio)</span><br><span class="line">beast_file &lt;- system.file(<span class="string">&quot;examples/MCC_FluA_H3.tree&quot;</span>, package=<span class="string">&quot;ggtree&quot;</span>)</span><br><span class="line">rst_file &lt;- system.file(<span class="string">&quot;examples/rst&quot;</span>, package=<span class="string">&quot;ggtree&quot;</span>)</span><br><span class="line">mlc_file &lt;- system.file(<span class="string">&quot;examples/mlc&quot;</span>, package=<span class="string">&quot;ggtree&quot;</span>)</span><br><span class="line">beast_tree &lt;- read.beast(beast_file)</span><br><span class="line">codeml_tree &lt;- read.codeml(rst_file, mlc_file)</span><br><span class="line"></span><br><span class="line">merged_tree &lt;- merge_tree(beast_tree, codeml_tree)</span><br><span class="line">merged_tree</span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## &#x27;treedata&#x27; S4 object that stored information of</span></span><br><span class="line"><span class="comment">##  &#x27;/home/ygc/R/library/ggtree/examples/MCC_FluA_H3.tree&#x27;,</span></span><br><span class="line"><span class="comment">##  &#x27;/home/ygc/R/library/ggtree/examples/rst&#x27;,</span></span><br><span class="line"><span class="comment">##  &#x27;/home/ygc/R/library/ggtree/examples/mlc&#x27;.</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## ...@ phylo: </span></span><br><span class="line"><span class="comment">## Phylogenetic tree with 76 tips and 75 internal nodes.</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Tip labels:</span></span><br><span class="line"><span class="comment">##   A/Hokkaido/30-1-a/2013, A/New_York/334/2004, A/New_York/463/2005, A/New_York/452/1999, A/New_York/238/2005, A/New_York/523/1998, ...</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Rooted; includes branch lengths.</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## with the following features available:</span></span><br><span class="line"><span class="comment">##  &#x27;height&#x27;,   &#x27;height_0.95_HPD&#x27;,  &#x27;height_median&#x27;,</span></span><br><span class="line"><span class="comment">##  &#x27;height_range&#x27;, &#x27;length&#x27;,   &#x27;length_0.95_HPD&#x27;,</span></span><br><span class="line"><span class="comment">##  &#x27;length_median&#x27;,    &#x27;length_range&#x27;, &#x27;posterior&#x27;,    &#x27;rate&#x27;,</span></span><br><span class="line"><span class="comment">##  &#x27;rate_0.95_HPD&#x27;,    &#x27;rate_median&#x27;,  &#x27;rate_range&#x27;,   &#x27;subs&#x27;,</span></span><br><span class="line"><span class="comment">##  &#x27;AA_subs&#x27;,  &#x27;t&#x27;,    &#x27;N&#x27;,    &#x27;S&#x27;,    &#x27;dN_vs_dS&#x27;, &#x27;dN&#x27;,   &#x27;dS&#x27;,   &#x27;N_x_dN&#x27;,</span></span><br><span class="line"><span class="comment">##  &#x27;S_x_dS&#x27;.</span></span><br></pre></td></tr></table></figure>

<p>合并后的树文件，除开<code>node</code>和<code>branches</code>外，其余的所有附加信息都变成了变量。</p>
<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/5.png" class="">

<p>既然是个数据框，那就可以对这些数据进行可视化：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">library(dplyr)</span><br><span class="line">df &lt;- merged_tree %&gt;% </span><br><span class="line">  as_tibble() %&gt;%</span><br><span class="line">  select(dN_vs_dS, dN, dS, rate) %&gt;%</span><br><span class="line">  subset(dN_vs_dS &gt;=<span class="number">0</span> &amp; dN_vs_dS &lt;= <span class="number">1.5</span>) %&gt;%</span><br><span class="line">  tidyr::gather(type, value, dN_vs_dS:dS)</span><br><span class="line">df$type[df$type == <span class="string">&#x27;dN_vs_dS&#x27;</span>] &lt;- <span class="string">&#x27;dN/dS&#x27;</span></span><br><span class="line">df$type &lt;- factor(df$type, levels=<span class="built_in">c</span>(<span class="string">&quot;dN/dS&quot;</span>, <span class="string">&quot;dN&quot;</span>, <span class="string">&quot;dS&quot;</span>))</span><br><span class="line">ggplot(df, aes(rate, value)) + geom_hex() + </span><br><span class="line">  facet_wrap(~type, scale=<span class="string">&#x27;free_y&#x27;</span>) </span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/6.png" class="">

<p>还可以利用该函数比较不同软件的分析结果：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">phylo &lt;- as.phylo(beast_tree)</span><br><span class="line">N &lt;- Nnode2(phylo)</span><br><span class="line">d &lt;- tibble(node = <span class="number">1</span>:N, fake_trait = rnorm(N), another_trait = runif(N))</span><br><span class="line">fake_tree &lt;- treedata(phylo = phylo, data = d)</span><br><span class="line">triple_tree &lt;- merge_tree(merged_tree, fake_tree)</span><br><span class="line">triple_tree</span><br></pre></td></tr></table></figure>

<h2 id="链接外部数据"><a href="#链接外部数据" class="headerlink" title="链接外部数据"></a>链接外部数据</h2><p>进化树能够展示的东西不仅仅是进化关系，还可以增添许多信息，如基因表达量啥的。<code>treeio</code>的函数<code>full_join()</code>能够通过<code>node</code>或<code>tips</code>进行数据融合：</p>
<ul>
<li><p>通过<code>node</code>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">library(ape)</span><br><span class="line">data(woodmouse)</span><br><span class="line">d &lt;- dist.dna(woodmouse)</span><br><span class="line">tr &lt;- nj(d)</span><br><span class="line">bp &lt;- boot.phylo(tr, </span><br><span class="line">                 woodmouse, </span><br><span class="line">                 <span class="keyword">function</span>(x) nj(dist.dna(x)))</span><br><span class="line"></span><br><span class="line">bp2 &lt;- tibble(node=<span class="number">1</span>:Nnode(tr) + <span class="comment"># 计算父节点数</span></span><br><span class="line">                Ntip(tr), <span class="comment"># 计算tip数</span></span><br><span class="line">              bootstrap = bp)</span><br><span class="line">full_join(tr, bp2, by=<span class="string">&quot;node&quot;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>通过<code>tips</code>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">file &lt;- system.file(<span class="string">&quot;extdata/BEAST&quot;</span>, <span class="string">&quot;beast_mcc.tree&quot;</span>, package=<span class="string">&quot;treeio&quot;</span>)</span><br><span class="line">beast &lt;- read.beast(file)</span><br><span class="line">x &lt;- tibble(label = as.phylo(beast)$tip.label, trait = rnorm(Ntip(beast)))</span><br><span class="line">full_join(beast, x, by=<span class="string">&quot;label&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="如何找到想要的node"><a href="#如何找到想要的node" class="headerlink" title="如何找到想要的node"></a>如何找到想要的<code>node</code></h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">library(ggtree)</span><br><span class="line">library(ggplot2)</span><br><span class="line"></span><br><span class="line">set.seed(<span class="number">1</span>)</span><br><span class="line">tr = rtree(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">p  + </span><br><span class="line">  geom_label(aes(x=branch, label=node))+</span><br><span class="line">  geom_hilight(node=<span class="number">12</span>, fill=<span class="string">&quot;steelblue&quot;</span>, alpha=<span class="number">.6</span>)</span><br></pre></td></tr></table></figure>

<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p><code>treeio</code>中的函数 <code>groupOTU()</code> 和 <code>groupClade()</code> 可以用于分组。</p>
<h3 id="groupClade"><a href="#groupClade" class="headerlink" title="groupClade"></a><code>groupClade</code></h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nwk &lt;- <span class="string">&#x27;(((((((A:4,B:4):6,C:5):8,D:6):3,E:21):10,((F:4,G:12):14,H:8):13):13,((I:5,J:2):30,(K:11,L:11):2):17):4,M:56);&#x27;</span></span><br><span class="line">tree &lt;- read.tree(text=nwk)</span><br><span class="line"></span><br><span class="line">groupClade(as_tibble(tree), <span class="built_in">c</span>(<span class="number">17</span>, <span class="number">21</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## # A tibble: 25 x 5</span></span><br><span class="line"><span class="comment">##    parent  node branch.length label group</span></span><br><span class="line"><span class="comment">##     &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;fct&gt;</span></span><br><span class="line"><span class="comment">##  1     20     1             4 A     1    </span></span><br><span class="line"><span class="comment">##  2     20     2             4 B     1    </span></span><br><span class="line"><span class="comment">##  3     19     3             5 C     1    </span></span><br><span class="line"><span class="comment">##  4     18     4             6 D     1    </span></span><br><span class="line"><span class="comment">##  5     17     5            21 E     1    </span></span><br><span class="line"><span class="comment">##  6     22     6             4 F     2    </span></span><br><span class="line"><span class="comment">##  7     22     7            12 G     2    </span></span><br><span class="line"><span class="comment">##  8     21     8             8 H     2    </span></span><br><span class="line"><span class="comment">##  9     24     9             5 I     0    </span></span><br><span class="line"><span class="comment">## 10     24    10             2 J     0    </span></span><br><span class="line"><span class="comment">## # … with 15 more rows</span></span><br></pre></td></tr></table></figure>

<p>以<code>node17</code>和<code>node21</code>为界将<code>clade</code>进行分组。这两个函数可以作用于<code>tbl_tree</code>、<code>phylo</code> 、 <code>treedata</code>及 <code>ggtree</code> 这些对象。</p>
<h3 id="groupOTU"><a href="#groupOTU" class="headerlink" title="groupOTU"></a><code>groupOTU</code></h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">set.seed(<span class="number">2017</span>)</span><br><span class="line">tr &lt;- rtree(<span class="number">4</span>)</span><br><span class="line">x &lt;- as_tibble(tr)</span><br><span class="line"><span class="comment">## 输入的节点可以是节点ID，也可以是Label</span></span><br><span class="line">groupOTU(x, <span class="built_in">c</span>(<span class="string">&#x27;t1&#x27;</span>, <span class="string">&#x27;t4&#x27;</span>), group_name = <span class="string">&quot;fake_group&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## # A tibble: 7 x 5</span></span><br><span class="line"><span class="comment">##   parent  node branch.length label fake_group</span></span><br><span class="line"><span class="comment">##    &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;fct&gt;     </span></span><br><span class="line"><span class="comment">## 1      5     1       0.435   t4    1         </span></span><br><span class="line"><span class="comment">## 2      7     2       0.674   t1    1         </span></span><br><span class="line"><span class="comment">## 3      7     3       0.00202 t3    0         </span></span><br><span class="line"><span class="comment">## 4      6     4       0.0251  t2    0         </span></span><br><span class="line"><span class="comment">## 5      5     5      NA       &lt;NA&gt;  1         </span></span><br><span class="line"><span class="comment">## 6      5     6       0.472   &lt;NA&gt;  1         </span></span><br><span class="line"><span class="comment">## 7      6     7       0.274   &lt;NA&gt;  1</span></span><br></pre></td></tr></table></figure>

<p>更常见的分组方法是直接命名分组：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cls &lt;- <span class="built_in">list</span>(c1=<span class="built_in">c</span>(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;E&quot;</span>),</span><br><span class="line">            c2=<span class="built_in">c</span>(<span class="string">&quot;F&quot;</span>, <span class="string">&quot;G&quot;</span>, <span class="string">&quot;H&quot;</span>),</span><br><span class="line">            c3=<span class="built_in">c</span>(<span class="string">&quot;L&quot;</span>, <span class="string">&quot;K&quot;</span>, <span class="string">&quot;I&quot;</span>, <span class="string">&quot;J&quot;</span>),</span><br><span class="line">            c4=<span class="string">&quot;M&quot;</span>)</span><br><span class="line"></span><br><span class="line">as_tibble(tree) %&gt;% groupOTU(cls)</span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## # A tibble: 25 x 5</span></span><br><span class="line"><span class="comment">##    parent  node branch.length label group</span></span><br><span class="line"><span class="comment">##     &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;fct&gt;</span></span><br><span class="line"><span class="comment">##  1     20     1             4 A     c1   </span></span><br><span class="line"><span class="comment">##  2     20     2             4 B     c1   </span></span><br><span class="line"><span class="comment">##  3     19     3             5 C     c1   </span></span><br><span class="line"><span class="comment">##  4     18     4             6 D     c1   </span></span><br><span class="line"><span class="comment">##  5     17     5            21 E     c1   </span></span><br><span class="line"><span class="comment">##  6     22     6             4 F     c2   </span></span><br><span class="line"><span class="comment">##  7     22     7            12 G     c2   </span></span><br><span class="line"><span class="comment">##  8     21     8             8 H     c2   </span></span><br><span class="line"><span class="comment">##  9     24     9             5 I     c3   </span></span><br><span class="line"><span class="comment">## 10     24    10             2 J     c3   </span></span><br><span class="line"><span class="comment">## # … with 15 more rows</span></span><br></pre></td></tr></table></figure>

<h2 id="重新标准化分支"><a href="#重新标准化分支" class="headerlink" title="重新标准化分支"></a>重新标准化分支</h2><p>不同的进化树可以进行合并，原始的分支长度可能单位不一样，这时候就可以用合并后的其他参数对分支长度进行标准化。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p1 &lt;- ggtree(merged_tree) + theme_tree2()</span><br><span class="line">p2 &lt;- ggtree(rescale_tree(merged_tree, <span class="string">&#x27;dN&#x27;</span>)) + theme_tree2()</span><br><span class="line">p3 &lt;- ggtree(rescale_tree(merged_tree, <span class="string">&#x27;rate&#x27;</span>)) + theme_tree2()</span><br><span class="line"></span><br><span class="line">cowplot::plot_grid(p1, p2, p3, ncol=<span class="number">3</span>, labels = <span class="built_in">LETTERS</span>[<span class="number">1</span>:<span class="number">3</span>])</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/7.png" class="">

<p>从上图可以看到的是，三个图的“横坐标”范围不一样，第一个图是原始的分支单位，第二个是以<code>dN</code>进行标准化的结果，第三个是以<code>rate</code>进行标准化的结果。</p>
<h2 id="子集操作"><a href="#子集操作" class="headerlink" title="子集操作"></a>子集操作</h2><h3 id="从树中除去tips"><a href="#从树中除去tips" class="headerlink" title="从树中除去tips"></a>从树中除去<code>tips</code></h3><p>有些时候出于某些原因（如序列质量、组装质量、比对错误等），我们会将某些<code>tips</code>（样本）从树里面剔除，函数<code>drop.tip()</code>可以实现这一功能：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">f &lt;- system.file(<span class="string">&quot;extdata/NHX&quot;</span>, <span class="string">&quot;phyldog.nhx&quot;</span>, package=<span class="string">&quot;treeio&quot;</span>)</span><br><span class="line">nhx &lt;- read.nhx(f)</span><br><span class="line">to_drop &lt;- <span class="built_in">c</span>(<span class="string">&quot;Physonect_sp_@2066767&quot;</span>,</span><br><span class="line">             <span class="string">&quot;Lychnagalma_utricularia@2253871&quot;</span>,</span><br><span class="line">             <span class="string">&quot;Kephyes_ovata@2606431&quot;</span>)</span><br><span class="line">p1 &lt;- ggtree(nhx) + geom_tiplab(aes(color = label %in% to_drop)) +</span><br><span class="line">  scale_color_manual(values=<span class="built_in">c</span>(<span class="string">&quot;black&quot;</span>, <span class="string">&quot;red&quot;</span>)) + xlim(<span class="number">0</span>, <span class="number">0.8</span>)</span><br><span class="line"></span><br><span class="line">nhx_reduced &lt;- drop.tip(as.phylo(nhx), to_drop) <span class="comment"># 发现需要转换成phylo对象才行</span></span><br><span class="line">p2 &lt;- ggtree(nhx_reduced) + geom_tiplab() + xlim(<span class="number">0</span>, <span class="number">0.8</span>)  </span><br><span class="line">cowplot::plot_grid(p1, p2, ncol=<span class="number">2</span>, labels = <span class="built_in">c</span>(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>))</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/8.png" class="">

<h3 id="根据tips取子集"><a href="#根据tips取子集" class="headerlink" title="根据tips取子集"></a>根据<code>tips</code>取子集</h3><p>如果一个进化树很复杂的话，要看我们感兴趣的部分就很难，这时候就需要将我们感兴趣的部分提取出来。<code>treeio</code>中的函数<code>tree_subset()</code>能够完成这一功能，即使是提取出来的子集，结构还是和原来的一样，不会发生变化。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">beast_file &lt;- system.file(<span class="string">&quot;examples/MCC_FluA_H3.tree&quot;</span>, package=<span class="string">&quot;ggtree&quot;</span>)</span><br><span class="line">beast_tree &lt;- read.beast(beast_file)</span><br><span class="line"></span><br><span class="line">p1 = ggtree(beast_tree) + </span><br><span class="line">  geom_tiplab() +  </span><br><span class="line">  ggtitle(<span class="string">&#x27;原始树&#x27;</span>) +</span><br><span class="line">  xlim(<span class="number">0</span>, <span class="number">40</span>) + theme_tree2()</span><br><span class="line"></span><br><span class="line">tree2 = tree_subset(beast_tree, <span class="string">&quot;A/Swine/HK/168/2012&quot;</span>, levels_back=<span class="number">4</span>)  </span><br><span class="line">p2 &lt;- ggtree(tree2, aes(color=group)) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;取子集&#x27;</span>) +</span><br><span class="line">  scale_color_manual(values = <span class="built_in">c</span>(<span class="string">&quot;black&quot;</span>, <span class="string">&quot;red&quot;</span>)) +</span><br><span class="line">  geom_tiplab() +  xlim(<span class="number">0</span>, <span class="number">4</span>) + theme_tree2() </span><br><span class="line"></span><br><span class="line">p3 &lt;- ggtree(tree2, aes(color=group)) +</span><br><span class="line">  geom_tiplab(hjust = -<span class="number">.1</span>) + xlim(<span class="number">0</span>, <span class="number">5</span>) + </span><br><span class="line">  geom_point(aes(fill = rate), shape = <span class="number">21</span>, size = <span class="number">4</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;用rate这个变量控制颜色&#x27;</span>) +</span><br><span class="line">  scale_color_manual(values = <span class="built_in">c</span>(<span class="string">&quot;black&quot;</span>, <span class="string">&quot;red&quot;</span>), guide = <span class="literal">FALSE</span>) +</span><br><span class="line">  scale_fill_continuous(low = <span class="string">&#x27;blue&#x27;</span>, high = <span class="string">&#x27;red&#x27;</span>) +</span><br><span class="line">  theme_tree2() + theme(legend.position = <span class="string">&#x27;right&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p4 &lt;- ggtree(tree2, aes(color=group), </span><br><span class="line">             root.position = as.phylo(tree2)$root.edge) +</span><br><span class="line">  geom_tiplab() + xlim(<span class="number">18</span>, <span class="number">24</span>) + </span><br><span class="line">  ggtitle(<span class="string">&#x27;添加根节点但不显示&#x27;</span>) +</span><br><span class="line">  scale_color_manual(values = <span class="built_in">c</span>(<span class="string">&quot;black&quot;</span>, <span class="string">&quot;red&quot;</span>)) +</span><br><span class="line">  theme_tree2()</span><br><span class="line"></span><br><span class="line">p5 &lt;- ggtree(tree2, aes(color=group), </span><br><span class="line">             root.position = as.phylo(tree2)$root.edge) +</span><br><span class="line">  geom_rootedge() + geom_tiplab() + xlim(<span class="number">0</span>, <span class="number">40</span>) + </span><br><span class="line">  ggtitle(<span class="string">&#x27;添加根节点且显示&#x27;</span>) +</span><br><span class="line">  scale_color_manual(values = <span class="built_in">c</span>(<span class="string">&quot;black&quot;</span>, <span class="string">&quot;red&quot;</span>)) +</span><br><span class="line">  theme_tree2()</span><br><span class="line"></span><br><span class="line">plot_grid(p2, p3, p4, p5, ncol=<span class="number">2</span>) %&gt;%</span><br><span class="line">  plot_grid(p1, ., ncol=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.png" class="">

<h3 id="根据内部节点编号取子集"><a href="#根据内部节点编号取子集" class="headerlink" title="根据内部节点编号取子集"></a>根据内部节点编号取子集</h3><p>如果我们对特定的进化分支（clade）感兴趣，那也可以通过<code>tree_subset()</code>函数将感兴趣的分支进行放大展示，但是这个时候需要我们知道感兴趣的进化分支所对应的<code>node</code>编号才行。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">clade &lt;- tree_subset(beast_tree, node=<span class="number">121</span>, levels_back=<span class="number">0</span>)</span><br><span class="line">clade2 &lt;- tree_subset(beast_tree, node=<span class="number">121</span>, levels_back=<span class="number">2</span>)</span><br><span class="line">p1 &lt;- ggtree(clade) + </span><br><span class="line">  ggtitle(<span class="string">&#x27;感兴趣的整个分支&#x27;</span>) +</span><br><span class="line">  geom_tiplab() + xlim(<span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line">p2 &lt;- ggtree(clade2, aes(color=group)) + </span><br><span class="line">  ggtitle(<span class="string">&#x27;感兴趣的整个分支 + 回退两个节点&#x27;</span>) +</span><br><span class="line">  geom_tiplab() + </span><br><span class="line">  xlim(<span class="number">0</span>, <span class="number">8</span>) + scale_color_manual(values=<span class="built_in">c</span>(<span class="string">&quot;black&quot;</span>, <span class="string">&quot;red&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">library(ape)</span><br><span class="line">library(tidytree)</span><br><span class="line">library(treeio)</span><br><span class="line">data(chiroptera)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果不知道node的时候，就直接进行匹配</span></span><br><span class="line">nodes &lt;- grep(<span class="string">&quot;Plecotus&quot;</span>, chiroptera$tip.label)</span><br><span class="line">chiroptera &lt;- groupOTU(chiroptera, nodes)</span><br><span class="line"></span><br><span class="line">p3 &lt;- ggtree(chiroptera, aes(colour = group)) + </span><br><span class="line">  ggtitle(<span class="string">&#x27;整个进化树中选择感兴趣的整个分支&#x27;</span>) +</span><br><span class="line">  scale_color_manual(values=<span class="built_in">c</span>(<span class="string">&quot;black&quot;</span>, <span class="string">&quot;red&quot;</span>)) +</span><br><span class="line">  theme(legend.position = <span class="string">&quot;none&quot;</span>)</span><br><span class="line"></span><br><span class="line">clade &lt;- MRCA(chiroptera, nodes) <span class="comment"># 最近的父节点</span></span><br><span class="line">x &lt;- tree_subset(chiroptera, clade, levels_back = <span class="number">0</span>)</span><br><span class="line">p4 &lt;- ggtree(x) + </span><br><span class="line">  ggtitle(<span class="string">&#x27;感兴趣的特有分支&#x27;</span>) +</span><br><span class="line">  geom_tiplab() + xlim(<span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">plot_grid(p1, p2, p3, p4,ncol=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.png" class="">

<h2 id="导出数据"><a href="#导出数据" class="headerlink" title="导出数据"></a>导出数据</h2><p><code>treeio</code>这个R包可以导出多种格式的文件，这个比较简单，详情参照：<a target="_blank" rel="noopener" href="https://yulab-smu.top/treedata-book/chapter3.html">https://yulab-smu.top/treedata-book/chapter3.html</a></p>
<h1 id="进化树可视化"><a href="#进化树可视化" class="headerlink" title="进化树可视化"></a>进化树可视化</h1><h2 id="基础方法"><a href="#基础方法" class="headerlink" title="基础方法"></a>基础方法</h2><p><code>ggtree</code>对进化树进行可视化的方法有两种：</p>
<ul>
<li><code>ggplot()</code> + <code>geom_tree()</code> + <code>theme_tree()</code></li>
<li><code>ggtree()</code></li>
</ul>
<p>第二种方法是第一种方法的“缩写版”。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">library(treeio)</span><br><span class="line">library(ggtree)</span><br><span class="line"></span><br><span class="line">nwk &lt;- system.file(<span class="string">&quot;extdata&quot;</span>, <span class="string">&quot;sample.nwk&quot;</span>, package=<span class="string">&quot;treeio&quot;</span>)</span><br><span class="line">tree &lt;- read.tree(nwk)</span><br><span class="line"></span><br><span class="line">ggplot(tree, aes(x, y)) + geom_tree() + theme_tree()</span><br><span class="line">ggtree(tree)</span><br></pre></td></tr></table></figure>

<p>这两种方法得到的结果是一样的：</p>
<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/11.png" class="">

<p><code>ggtree</code>支持<code>ggplot2</code>的图形语法，因此，也可以在<code>ggtree</code>中对颜色性状等进行修改：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">library(ggplot2)</span><br><span class="line">library(treeio)</span><br><span class="line">library(ggtree)</span><br><span class="line"></span><br><span class="line">nwk &lt;- system.file(<span class="string">&quot;extdata&quot;</span>, <span class="string">&quot;sample.nwk&quot;</span>, package=<span class="string">&quot;treeio&quot;</span>)</span><br><span class="line">tree &lt;- read.tree(nwk)</span><br><span class="line"></span><br><span class="line">ggplot(tree, aes(x, y)) + geom_tree() + theme_tree()</span><br><span class="line">ggtree(tree)</span><br><span class="line"></span><br><span class="line">p1 = ggtree(tree, color=<span class="string">&quot;firebrick&quot;</span>, size=<span class="number">2</span>, linetype=<span class="string">&quot;dotted&quot;</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;阶梯化&#x27;</span>)</span><br><span class="line">p2 = ggtree(tree, color=<span class="string">&quot;firebrick&quot;</span>, size=<span class="number">2</span>, linetype=<span class="string">&quot;dotted&quot;</span>, ladderize=<span class="literal">FALSE</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;非阶梯化&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cowplot::plot_grid(p1,p2)v</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/12.png" class="">

<p>可以使用参数<code>branch.length</code>对egde进行标准化，如果参数为<code>none</code>，则是这样：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ggtree(tree, branch.length=<span class="string">&quot;none&quot;</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/13.png" class="">

<h2 id="输出样式"><a href="#输出样式" class="headerlink" title="输出样式"></a>输出样式</h2><p><code>ggtree</code>支持多种输出样式：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">library(ggtree)</span><br><span class="line">set.seed(<span class="number">2017</span>-<span class="number">02</span>-<span class="number">16</span>)</span><br><span class="line">tree &lt;- rtree(<span class="number">50</span>)</span><br><span class="line">p1 = ggtree(tree) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;默认&#x27;</span>)</span><br><span class="line">p2 = ggtree(tree, layout=<span class="string">&quot;roundrect&quot;</span>)  +</span><br><span class="line">  ggtitle(<span class="string">&#x27;roundrect&#x27;</span>)</span><br><span class="line">p3 = ggtree(tree, layout=<span class="string">&quot;slanted&quot;</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;slanted&#x27;</span>)</span><br><span class="line">p4 = ggtree(tree, layout=<span class="string">&quot;ellipse&quot;</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;ellipse&#x27;</span>)</span><br><span class="line">p5 = ggtree(tree, layout=<span class="string">&quot;circular&quot;</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;circular&#x27;</span>)</span><br><span class="line">p6 = ggtree(tree, layout=<span class="string">&quot;fan&quot;</span>, open.angle=<span class="number">120</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;fan&#x27;</span>)</span><br><span class="line">p7 = ggtree(tree, layout=<span class="string">&quot;equal_angle&quot;</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;equal_angle&#x27;</span>)</span><br><span class="line">p8 = ggtree(tree, layout=<span class="string">&quot;daylight&quot;</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;daylight&#x27;</span>)</span><br><span class="line">p9 = ggtree(tree, branch.length=<span class="string">&#x27;none&#x27;</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;none&#x27;</span>)</span><br><span class="line">p10 = ggtree(tree, layout=<span class="string">&quot;ellipse&quot;</span>, branch.length=<span class="string">&quot;none&quot;</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;ellipse对齐&#x27;</span>)</span><br><span class="line">p11 = ggtree(tree, branch.length=<span class="string">&#x27;none&#x27;</span>, layout=<span class="string">&#x27;circular&#x27;</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;circular对齐&#x27;</span>)</span><br><span class="line">p12 = ggtree(tree, layout=<span class="string">&quot;daylight&quot;</span>, branch.length = <span class="string">&#x27;none&#x27;</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;daylight对齐&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cowplot::plot_grid(p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12, ncol = <span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/14.png" class="">

<p>当只是展示树结构而没有分支长度标尺的时候，就用最下面这4种。</p>
<p>还有其他的多种对齐方式：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ggtree(tree) + scale_x_reverse()</span><br><span class="line">ggtree(tree) + coord_flip()</span><br><span class="line">ggtree(tree) + layout_dendrogram()</span><br><span class="line">ggplotify::as.ggplot(ggtree(x), angle=-<span class="number">30</span>, scale=<span class="number">.9</span>)</span><br><span class="line">ggtree(tree, layout=<span class="string">&#x27;slanted&#x27;</span>) + coord_flip()</span><br><span class="line">ggtree(tree, layout=<span class="string">&#x27;slanted&#x27;</span>, branch.length=<span class="string">&#x27;none&#x27;</span>) + layout_dendrogram()</span><br><span class="line">ggtree(tree, layout=<span class="string">&#x27;circular&#x27;</span>) + xlim(-<span class="number">10</span>, <span class="literal">NA</span>)</span><br><span class="line">ggtree(tree) + layout_inward_circular()</span><br><span class="line">ggtree(tree) + layout_inward_circular(xlim=<span class="number">15</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/15.png" class="">

<p>如果是时间范围数据的话，则需要调用参数<code>mrsd</code>（most recent sample data）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">beast_file &lt;- system.file(<span class="string">&quot;examples/MCC_FluA_H3.tree&quot;</span>, </span><br><span class="line">                          package=<span class="string">&quot;ggtree&quot;</span>)</span><br><span class="line">beast_tree &lt;- read.beast(beast_file)</span><br><span class="line">ggtree(beast_tree, mrsd=<span class="string">&quot;2013-01-01&quot;</span>) + theme_tree2()</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/16.png" class="">

<h2 id="展示相关元素"><a href="#展示相关元素" class="headerlink" title="展示相关元素"></a>展示相关元素</h2><h3 id="展示进化距离"><a href="#展示进化距离" class="headerlink" title="展示进化距离"></a>展示进化距离</h3><p>函数<code>geom_treescale()</code>用于展示进化距离。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">p1 = ggtree(tree) + geom_treescale() + ggtitle(<span class="string">&#x27;默认&#x27;</span>)</span><br><span class="line">p2 = ggtree(tree) + geom_treescale(x=<span class="number">0</span>, y=<span class="number">45</span>, width=<span class="number">1</span>, color=<span class="string">&#x27;red&#x27;</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;设定位置、宽度、颜色&#x27;</span>)</span><br><span class="line">p3 = ggtree(tree) + geom_treescale(fontsize=<span class="number">6</span>, linesize=<span class="number">2</span>, offset=<span class="number">1</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;设定字体大小、线条大小、缩进&#x27;</span>)</span><br><span class="line">p4 = ggtree(tree) + theme_tree2() +</span><br><span class="line">  ggtitle(<span class="string">&#x27;使用内置主题&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cowplot::plot_grid(p1,p2,p3,p4, ncol = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/17.png" class="">

<h3 id="展示-nodes-tips"><a href="#展示-nodes-tips" class="headerlink" title="展示 nodes/tips"></a>展示<code> nodes/tips</code></h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p1 = ggtree(tree) + geom_point(aes(shape=isTip, color=isTip), size=<span class="number">3</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;使用geom_point()函数&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p2 &lt;- ggtree(tree) + geom_nodepoint(color=<span class="string">&quot;#b5e521&quot;</span>, alpha=<span class="number">1</span>/<span class="number">4</span>, size=<span class="number">10</span>) +</span><br><span class="line">  geom_tippoint(color=<span class="string">&quot;#FDAC4F&quot;</span>, shape=<span class="number">8</span>, size=<span class="number">3</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;使用两个函数&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cowplot::plot_grid(p1,p2, ncol = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/18.png" class="">

<h3 id="展示tips的标签"><a href="#展示tips的标签" class="headerlink" title="展示tips的标签"></a>展示<code>tips</code>的标签</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p1 = ggtree(tree) + geom_nodepoint(color=<span class="string">&quot;#b5e521&quot;</span>, alpha=<span class="number">1</span>/<span class="number">4</span>, size=<span class="number">10</span>) +</span><br><span class="line">  geom_tippoint(color=<span class="string">&quot;#FDAC4F&quot;</span>, shape=<span class="number">8</span>, size=<span class="number">3</span>) + </span><br><span class="line">  geom_tiplab(size=<span class="number">3</span>, color=<span class="string">&quot;purple&quot;</span>)</span><br><span class="line"></span><br><span class="line">p2 = ggtree(tree, layout=<span class="string">&quot;circular&quot;</span>) + </span><br><span class="line">  geom_tiplab(aes(angle=angle), color=<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p3 = ggtree(tree, branch.length = <span class="string">&#x27;none&#x27;</span>) + </span><br><span class="line">  geom_tiplab(as_ylab=<span class="literal">TRUE</span>, color=<span class="string">&#x27;firebrick&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cowplot::plot_grid(p1, p2,p3, ncol = <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/19.png" class="">

<h3 id="展示根节点"><a href="#展示根节点" class="headerlink" title="展示根节点"></a>展示根节点</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## with root edge = 1</span></span><br><span class="line">tree1 &lt;- read.tree(text=<span class="string">&#x27;((A:1,B:2):3,C:2):1;&#x27;</span>)</span><br><span class="line">p1 = ggtree(tree1) + geom_tiplab() + geom_rootedge() +</span><br><span class="line">  ggtitle(<span class="string">&#x27;有根节点信息&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## without root edge</span></span><br><span class="line">tree2 &lt;- read.tree(text=<span class="string">&#x27;((A:1,B:2):3,C:2);&#x27;</span>)</span><br><span class="line">p2 = ggtree(tree2) + geom_tiplab() + geom_rootedge() +</span><br><span class="line">  ggtitle(<span class="string">&#x27;无根节点信息，默认无&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## setting root edge</span></span><br><span class="line">tree2$root.edge &lt;- 2</span><br><span class="line">p3 = ggtree(tree2) + geom_tiplab() + geom_rootedge() +</span><br><span class="line">  ggtitle(<span class="string">&#x27;无根节点信息，添加信息&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## specify length of root edge for just plotting</span></span><br><span class="line"><span class="comment">## this will ignore tree$root.edge</span></span><br><span class="line">p4 = ggtree(tree2) + geom_tiplab() + geom_rootedge(rootedge = <span class="number">3</span>) +</span><br><span class="line">  ggtitle(<span class="string">&#x27;无根节点信息，设置信息&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cowplot::plot_grid(p1,p2,p3,p4, ncol = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/20.png" class="">

<h3 id="上色"><a href="#上色" class="headerlink" title="上色"></a>上色</h3><p>上色直接是很简单，就像<code>ggplot2</code>那样：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggtree(beast_tree, aes(color=rate)) +</span><br><span class="line">  scale_color_continuous(low=<span class="string">&#x27;darkgreen&#x27;</span>, high=<span class="string">&#x27;red&#x27;</span>) +</span><br><span class="line">  theme(legend.position=<span class="string">&quot;right&quot;</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/21.png" class="">

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">anole.tree&lt;-read.tree(<span class="string">&quot;http://www.phytools.org/eqg2015/data/anole.tre&quot;</span>)</span><br><span class="line">svl &lt;- read.csv(<span class="string">&quot;http://www.phytools.org/eqg2015/data/svl.csv&quot;</span>,</span><br><span class="line">                row.names=<span class="number">1</span>)</span><br><span class="line">svl &lt;- as.matrix(svl)[,<span class="number">1</span>]</span><br><span class="line">fit &lt;- phytools::fastAnc(anole.tree,svl,vars=<span class="literal">TRUE</span>,CI=<span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line">td &lt;- data.frame(node = nodeid(anole.tree, <span class="built_in">names</span>(svl)),</span><br><span class="line">                 trait = svl)</span><br><span class="line">nd &lt;- data.frame(node = <span class="built_in">names</span>(fit$ace), trait = fit$ace)</span><br><span class="line"></span><br><span class="line">d &lt;- rbind(td, nd)</span><br><span class="line">d$node &lt;- <span class="built_in">as.numeric</span>(d$node)</span><br><span class="line">tree &lt;- full_join(anole.tree, d, by = <span class="string">&#x27;node&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p1 &lt;- ggtree(tree, aes(color=trait), layout = <span class="string">&#x27;circular&#x27;</span>, </span><br><span class="line">             ladderize = <span class="literal">FALSE</span>, continuous = <span class="literal">TRUE</span>, size=<span class="number">2</span>) +</span><br><span class="line">  scale_color_gradientn(colours=<span class="built_in">c</span>(<span class="string">&quot;red&quot;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;green&#x27;</span>, <span class="string">&#x27;cyan&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>)) +</span><br><span class="line">  geom_tiplab(hjust = -<span class="number">.1</span>) + </span><br><span class="line">  xlim(<span class="number">0</span>, <span class="number">1.2</span>) + </span><br><span class="line">  theme(legend.position = <span class="built_in">c</span>(<span class="number">.05</span>, <span class="number">.85</span>)) </span><br><span class="line"></span><br><span class="line">p2 &lt;- ggtree(tree, layout=<span class="string">&#x27;circular&#x27;</span>, ladderize = <span class="literal">FALSE</span>, size=<span class="number">2.8</span>) + </span><br><span class="line">  geom_tree(aes(color=trait), continuous=<span class="built_in">T</span>, size=<span class="number">2</span>) +  </span><br><span class="line">  scale_color_gradientn(colours=<span class="built_in">c</span>(<span class="string">&quot;red&quot;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;green&#x27;</span>, <span class="string">&#x27;cyan&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>)) +</span><br><span class="line">  geom_tiplab(aes(color=trait), hjust = -<span class="number">.1</span>) + </span><br><span class="line">  xlim(<span class="number">0</span>, <span class="number">1.2</span>) + </span><br><span class="line">  theme(legend.position = <span class="built_in">c</span>(<span class="number">.05</span>, <span class="number">.85</span>)) </span><br><span class="line"></span><br><span class="line">cowplot::plot_grid(p1, p2, ncol=<span class="number">2</span>, labels=<span class="built_in">c</span>(<span class="string">&quot;分支默认边框&quot;</span>, <span class="string">&quot;分支黑色边框&quot;</span>))    </span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/22.png" class="">

<h3 id="对树进行重新标准化"><a href="#对树进行重新标准化" class="headerlink" title="对树进行重新标准化"></a>对树进行重新标准化</h3><p>多个参数对进化树进行标准化，时间序列相关的参数用<code>msrd</code>，其余的参数可以用<code>branch.length</code>。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">library(treeio)</span><br><span class="line">beast_file &lt;- system.file(<span class="string">&quot;examples/MCC_FluA_H3.tree&quot;</span>, package=<span class="string">&quot;ggtree&quot;</span>)</span><br><span class="line">beast_tree &lt;- read.beast(beast_file)</span><br><span class="line">beast_tree</span><br><span class="line"></span><br><span class="line">p1 &lt;- ggtree(beast_tree, mrsd=<span class="string">&#x27;2013-01-01&#x27;</span>) + theme_tree2() +</span><br><span class="line">  labs(caption=<span class="string">&quot;时间序列&quot;</span>)</span><br><span class="line">p2 &lt;- ggtree(beast_tree, branch.length=<span class="string">&#x27;rate&#x27;</span>) + theme_tree2() +</span><br><span class="line">  labs(caption=<span class="string">&quot;取代速率&quot;</span>)</span><br><span class="line"></span><br><span class="line">mlcfile &lt;- system.file(<span class="string">&quot;extdata/PAML_Codeml&quot;</span>, <span class="string">&quot;mlc&quot;</span>, package=<span class="string">&quot;treeio&quot;</span>)</span><br><span class="line">mlc_tree &lt;- read.codeml_mlc(mlcfile)</span><br><span class="line">p3 &lt;- ggtree(mlc_tree) + theme_tree2() +</span><br><span class="line">  labs(caption=<span class="string">&quot;单密码子核苷酸取代&quot;</span>)</span><br><span class="line">p4 &lt;- ggtree(mlc_tree, branch.length=<span class="string">&#x27;dN_vs_dS&#x27;</span>) + theme_tree2() +</span><br><span class="line">  labs(caption=<span class="string">&quot;dN/dS&quot;</span>)</span><br><span class="line"></span><br><span class="line">cowplot::plot_grid(p1,p2,p3,p4, ncol = <span class="number">2</span></span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/23.png" class="">

<p>也可以用<code>rescale_tree</code>对树进行标准化：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">beast_tree2 &lt;- rescale_tree(beast_tree, branch.length=<span class="string">&#x27;rate&#x27;</span>)</span><br><span class="line">ggtree(beast_tree2) + theme_tree2()</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/24.png" class="">

<h3 id="背景色"><a href="#背景色" class="headerlink" title="背景色"></a>背景色</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set.seed(<span class="number">2019</span>)</span><br><span class="line">x &lt;- rtree(<span class="number">30</span>)</span><br><span class="line">p1 = ggtree(x, color=<span class="string">&quot;red&quot;</span>) + theme_tree(<span class="string">&quot;steelblue&quot;</span>)</span><br><span class="line">p2 = ggtree(x, color=<span class="string">&quot;white&quot;</span>) + theme_tree(<span class="string">&quot;black&quot;</span>)</span><br><span class="line"></span><br><span class="line">cowplot::plot_grid(p1,p2, ncol = <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/25.png" class="">

<h3 id="批量建树"><a href="#批量建树" class="headerlink" title="批量建树"></a>批量建树</h3><p>批量建树就相当于<code>ggplot2</code>中的分面：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## trees &lt;- lapply(c(10, 20, 40), rtree)</span></span><br><span class="line"><span class="comment">## class(trees) &lt;- &quot;multiPhylo&quot;</span></span><br><span class="line"><span class="comment">## ggtree(trees) + facet_wrap(~.id, scale=&quot;free&quot;) + geom_tiplab()</span></span><br><span class="line"></span><br><span class="line">r8s &lt;- read.r8s(system.file(<span class="string">&quot;extdata/r8s&quot;</span>, <span class="string">&quot;H3_r8s_output.log&quot;</span>, package=<span class="string">&quot;treeio&quot;</span>))</span><br><span class="line">ggtree(r8s) + facet_wrap( ~.id, scale=<span class="string">&quot;free&quot;</span>) + theme_tree2()</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/26.png" class="">

<h1 id="进化树注释"><a href="#进化树注释" class="headerlink" title="进化树注释"></a>进化树注释</h1><h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><p>注释的信息很多，节点的分组、样品来源、基因表达量等都可以作为注释的信息。一个简单的例子：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">library(ggtree)</span><br><span class="line">treetext = <span class="string">&quot;(((ADH2:0.1[&amp;&amp;NHX:S=human], ADH1:0.11[&amp;&amp;NHX:S=human]):</span></span><br><span class="line"><span class="string">0.05 [&amp;&amp;NHX:S=primates:D=Y:B=100],ADHY:</span></span><br><span class="line"><span class="string">0.1[&amp;&amp;NHX:S=nematode],ADHX:0.12 [&amp;&amp;NHX:S=insect]):</span></span><br><span class="line"><span class="string">0.1[&amp;&amp;NHX:S=metazoa:D=N],(ADH4:0.09[&amp;&amp;NHX:S=yeast],</span></span><br><span class="line"><span class="string">ADH3:0.13[&amp;&amp;NHX:S=yeast], ADH2:0.12[&amp;&amp;NHX:S=yeast],</span></span><br><span class="line"><span class="string">ADH1:0.11[&amp;&amp;NHX:S=yeast]):0.1[&amp;&amp;NHX:S=Fungi])[&amp;&amp;NHX:D=N];&quot;</span></span><br><span class="line">tree &lt;- read.nhx(textConnection(treetext))</span><br><span class="line">ggtree(tree) + geom_tiplab() + </span><br><span class="line">  geom_label(aes(x=branch, label=S), fill=<span class="string">&#x27;lightgreen&#x27;</span>) + </span><br><span class="line">  geom_label(aes(label=D), fill=<span class="string">&#x27;steelblue&#x27;</span>) + </span><br><span class="line">  geom_text(aes(label=B), hjust=-<span class="number">.5</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/27.png" class="">

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/28.png" class="">

<h2 id="clade注释"><a href="#clade注释" class="headerlink" title="clade注释"></a><code>clade</code>注释</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">set.seed(<span class="number">2015</span>-<span class="number">12</span>-<span class="number">21</span>)</span><br><span class="line">tree &lt;- rtree(<span class="number">30</span>)</span><br><span class="line">p1 &lt;- ggtree(tree) + xlim(<span class="literal">NA</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">p2 = p1 + geom_cladelabel(node=<span class="number">45</span>, label=<span class="string">&quot;test label&quot;</span>) +</span><br><span class="line">  geom_cladelabel(node=<span class="number">34</span>, label=<span class="string">&quot;another clade&quot;</span>)</span><br><span class="line"></span><br><span class="line">p3 = p1 + geom_cladelabel(node=<span class="number">45</span>, label=<span class="string">&quot;test label&quot;</span>, align=<span class="literal">TRUE</span>,  offset = <span class="number">.2</span>, color=<span class="string">&#x27;red&#x27;</span>) +</span><br><span class="line">  geom_cladelabel(node=<span class="number">34</span>, label=<span class="string">&quot;another clade&quot;</span>, align=<span class="literal">TRUE</span>, offset = <span class="number">.2</span>, color=<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p4 = p1 + geom_cladelabel(node=<span class="number">45</span>, label=<span class="string">&quot;test label&quot;</span>, align=<span class="built_in">T</span>, angle=<span class="number">270</span>, hjust=<span class="string">&#x27;center&#x27;</span>, offset.text=<span class="number">.5</span>, barsize=<span class="number">1.5</span>) +</span><br><span class="line">  geom_cladelabel(node=<span class="number">34</span>, label=<span class="string">&quot;another clade&quot;</span>, align=<span class="built_in">T</span>, angle=<span class="number">45</span>, fontsize=<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">p5 = p1 + geom_cladelabel(node=<span class="number">34</span>, label=<span class="string">&quot;another clade&quot;</span>, align=<span class="built_in">T</span>, geom=<span class="string">&#x27;label&#x27;</span>, fill=<span class="string">&#x27;lightblue&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cowplot::plot_grid(p2,p3,p4,p5,ncol = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/29.png" class="">

<p>同样也适用于无根输出样式，可以根据<code>node</code>的编号，也可以直接用<code>tips</code>的标签（这个是真的赞啊）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">p1 = ggtree(tree, layout=<span class="string">&quot;daylight&quot;</span>) + </span><br><span class="line">  geom_cladelabel(node=<span class="number">35</span>, label=<span class="string">&quot;test label&quot;</span>, angle=<span class="number">0</span>, </span><br><span class="line">                  fontsize=<span class="number">8</span>, offset=<span class="number">.5</span>, vjust=<span class="number">.5</span>)  + </span><br><span class="line">  geom_cladelabel(node=<span class="number">55</span>, label=<span class="string">&#x27;another clade&#x27;</span>, </span><br><span class="line">                  angle=-<span class="number">95</span>, hjust=<span class="number">.5</span>, fontsize=<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p2 = ggtree(tree) + xlim(<span class="literal">NA</span>, <span class="number">6</span>) + </span><br><span class="line">  geom_tiplab() + </span><br><span class="line">  geom_strip(<span class="string">&#x27;t10&#x27;</span>, <span class="string">&#x27;t30&#x27;</span>, barsize=<span class="number">2</span>, color=<span class="string">&#x27;red&#x27;</span>, </span><br><span class="line">             label=<span class="string">&quot;associated taxa&quot;</span>, offset.text=<span class="number">.1</span>) + </span><br><span class="line">  geom_strip(<span class="string">&#x27;t1&#x27;</span>, <span class="string">&#x27;t18&#x27;</span>, barsize=<span class="number">2</span>, color=<span class="string">&#x27;blue&#x27;</span>, </span><br><span class="line">             label = <span class="string">&quot;another label&quot;</span>, offset.text=<span class="number">.1</span>)</span><br><span class="line"></span><br><span class="line">cowplot::plot_grid(p1,p2,ncol = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/30.png" class="">

<h2 id="局部高亮"><a href="#局部高亮" class="headerlink" title="局部高亮"></a>局部高亮</h2><p>局部高亮可以根据<code>node</code>编号进行高亮，也可以使用附加数据或树数据里面的数据进行高亮：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">nwk &lt;- system.file(<span class="string">&quot;extdata&quot;</span>, <span class="string">&quot;sample.nwk&quot;</span>, package=<span class="string">&quot;treeio&quot;</span>)</span><br><span class="line">tree &lt;- read.tree(nwk)</span><br><span class="line"></span><br><span class="line">p1 = ggtree(tree) + </span><br><span class="line">  geom_hilight(node=<span class="number">21</span>, fill=<span class="string">&quot;steelblue&quot;</span>, alpha=<span class="number">.6</span>) +</span><br><span class="line">  geom_hilight(node=<span class="number">17</span>, fill=<span class="string">&quot;darkgreen&quot;</span>, alpha=<span class="number">.6</span>) </span><br><span class="line"></span><br><span class="line">p2 = ggtree(tree, layout=<span class="string">&quot;circular&quot;</span>) + </span><br><span class="line">  geom_hilight(node=<span class="number">21</span>, fill=<span class="string">&quot;steelblue&quot;</span>, alpha=<span class="number">.6</span>) +</span><br><span class="line">  geom_hilight(node=<span class="number">23</span>, fill=<span class="string">&quot;darkgreen&quot;</span>, alpha=<span class="number">.6</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## type can be &#x27;encircle&#x27; or &#x27;rect&#x27;</span></span><br><span class="line">ggtree(tree, layout=<span class="string">&quot;daylight&quot;</span>, branch.length = <span class="string">&#x27;none&#x27;</span>) + </span><br><span class="line">  geom_hilight(node=<span class="number">10</span>) + </span><br><span class="line">  geom_hilight(node=<span class="number">16</span>, fill=<span class="string">&#x27;darkgreen&#x27;</span>, type=<span class="string">&quot;rect&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ggtree(tree) +</span><br><span class="line">  geom_balance(node=<span class="number">16</span>, fill=<span class="string">&#x27;steelblue&#x27;</span>, color=<span class="string">&#x27;white&#x27;</span>, alpha=<span class="number">0.6</span>, extend=<span class="number">1</span>) +</span><br><span class="line">  geom_balance(node=<span class="number">19</span>, fill=<span class="string">&#x27;darkgreen&#x27;</span>, color=<span class="string">&#x27;white&#x27;</span>, alpha=<span class="number">0.6</span>, extend=<span class="number">1</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">## using external data</span></span><br><span class="line">d &lt;- data.frame(node=<span class="built_in">c</span>(<span class="number">17</span>, <span class="number">21</span>), type=<span class="built_in">c</span>(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>))</span><br><span class="line">ggtree(tree) + geom_hilight(data=d, aes(node=node, fill=type))</span><br><span class="line"></span><br><span class="line"><span class="comment">## using data stored in tree object</span></span><br><span class="line">x &lt;- read.nhx(system.file(<span class="string">&quot;extdata/NHX/ADH.nhx&quot;</span>, package=<span class="string">&quot;treeio&quot;</span>))</span><br><span class="line">ggtree(x) + </span><br><span class="line">  geom_hilight(mapping=aes(subset = node %in% <span class="built_in">c</span>(<span class="number">10</span>, <span class="number">12</span>), fill = S)) +</span><br><span class="line">  scale_fill_manual(values=<span class="built_in">c</span>(<span class="string">&quot;steelblue&quot;</span>, <span class="string">&quot;darkgreen&quot;</span>))</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/31.png" class="">

<h2 id="高亮不同分组"><a href="#高亮不同分组" class="headerlink" title="高亮不同分组"></a>高亮不同分组</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">mytree &lt;- read.tree(<span class="string">&quot;data/Tree 30.4.19.nwk&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define nodes for coloring later on</span></span><br><span class="line">tiplab &lt;- mytree$tip.label</span><br><span class="line">cls &lt;- tiplab[grep(<span class="string">&quot;^ch&quot;</span>, tiplab)] </span><br><span class="line">labeltree &lt;- groupOTU(mytree, cls)</span><br><span class="line"></span><br><span class="line">p &lt;- ggtree(labeltree, aes(color=group, linetype=group), layout=<span class="string">&quot;circular&quot;</span>) +</span><br><span class="line">    scale_color_manual(values = <span class="built_in">c</span>(<span class="string">&quot;#efad29&quot;</span>, <span class="string">&quot;#63bbd4&quot;</span>)) +</span><br><span class="line">    geom_nodepoint(color=<span class="string">&quot;black&quot;</span>, size=<span class="number">0.1</span>) +</span><br><span class="line">    geom_tiplab(size=<span class="number">2</span>, color=<span class="string">&quot;black&quot;</span>)</span><br><span class="line"></span><br><span class="line">p2 &lt;- flip(p, <span class="number">136</span>, <span class="number">110</span>) %&gt;% </span><br><span class="line">    flip(<span class="number">141</span>, <span class="number">145</span>) %&gt;% </span><br><span class="line">    rotate(<span class="number">141</span>) %&gt;% </span><br><span class="line">    rotate(<span class="number">142</span>) %&gt;% </span><br><span class="line">    rotate(<span class="number">160</span>) %&gt;% </span><br><span class="line">    rotate(<span class="number">164</span>) %&gt;% </span><br><span class="line">    rotate(<span class="number">131</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">### Group V and II coloring </span></span><br><span class="line">p3 &lt;- p2 + geom_hilight(node = <span class="number">110</span>, fill = <span class="string">&quot;#229f8a&quot;</span>, alpha = <span class="number">0.2</span>, extend = <span class="number">0.43</span>) +    </span><br><span class="line">    geom_hilight(node = <span class="number">88</span>, fill = <span class="string">&quot;#229f8a&quot;</span>, alpha = <span class="number">0.2</span>, extend = <span class="number">0.445</span>) +</span><br><span class="line">    geom_hilight(node = <span class="number">156</span>, fill = <span class="string">&quot;#229f8a&quot;</span>, alpha = <span class="number">0.2</span>, extend = <span class="number">0.35</span>) +</span><br><span class="line">    geom_hilight(node = <span class="number">136</span>, fill = <span class="string">&quot;#f9311f&quot;</span>, alpha = <span class="number">0.2</span>, extend = <span class="number">0.512</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">### Putting on a label on the avian specific expansion </span></span><br><span class="line">p4 &lt;- p3 + geom_cladelabel(node = <span class="number">113</span>, label = <span class="string">&quot;Avian-specific expansion&quot;</span>, </span><br><span class="line">                        align = <span class="literal">TRUE</span>, angle = -<span class="number">35</span>, offset.text = <span class="number">0.05</span>, </span><br><span class="line">                        hjust = <span class="string">&quot;center&quot;</span>, fontsize = <span class="number">2</span>,  offset = <span class="number">0.2</span>, barsize = <span class="number">0.2</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">### Adding the bootstrap values with subset used to remove all bootstraps &lt; 50  </span></span><br><span class="line">p5 &lt;- p4 + geom_text2(aes(label=label, </span><br><span class="line">                        subset = !<span class="built_in">is.na</span>(<span class="built_in">as.numeric</span>(label)) &amp; <span class="built_in">as.numeric</span>(label) &gt; <span class="number">50</span>), </span><br><span class="line">                    size = <span class="number">2</span>, color = <span class="string">&quot;black&quot;</span>,nudge_y = <span class="number">0.7</span>, nudge_x = -<span class="number">0.05</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">### Putting labels on the subgroups </span></span><br><span class="line">p6 &lt;- p5 + geom_cladelabel(node = <span class="number">114</span>, label = <span class="string">&quot;Subgroup A&quot;</span>, align = <span class="literal">TRUE</span>, </span><br><span class="line">                        angle = -<span class="number">55</span>, offset.text = <span class="number">.03</span>, hjust = <span class="string">&quot;center&quot;</span>, </span><br><span class="line">                        offset = <span class="number">0.05</span>, barsize = <span class="number">0.2</span>, fontsize = <span class="number">2</span>) +</span><br><span class="line">            geom_cladelabel(node = <span class="number">121</span>, label = <span class="string">&quot;Subgroup B&quot;</span>, align = <span class="literal">TRUE</span>, </span><br><span class="line">                        angle = -<span class="number">15</span>, offset.text = <span class="number">.03</span>, hjust = <span class="string">&quot;center&quot;</span>, </span><br><span class="line">                        offset = <span class="number">0.05</span>, barsize = <span class="number">0.2</span>, fontsize = <span class="number">2</span>) +</span><br><span class="line">            theme(legend.position=<span class="string">&quot;none&quot;</span>, </span><br><span class="line">                plot.margin=grid::unit(<span class="built_in">c</span>(-<span class="number">15</span>,-<span class="number">15</span>,-<span class="number">15</span>,-<span class="number">15</span>), <span class="string">&quot;mm&quot;</span>))</span><br><span class="line"></span><br><span class="line">print(p6)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/62.png" class="">

<h2 id="样品连接"><a href="#样品连接" class="headerlink" title="样品连接"></a>样品连接</h2><p>利用函数<code>geom_taxalink()</code>可以实现样品之间的连线，但是只支持有限的几种形式：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">p1 &lt;- ggtree(tree) + geom_tiplab() + </span><br><span class="line">  geom_taxalink(taxa1=<span class="string">&#x27;A&#x27;</span>, taxa2=<span class="string">&#x27;E&#x27;</span>) + </span><br><span class="line">  geom_taxalink(taxa1=<span class="string">&#x27;F&#x27;</span>, taxa2=<span class="string">&#x27;K&#x27;</span>, </span><br><span class="line">                color=<span class="string">&#x27;red&#x27;</span>, linetype = <span class="string">&#x27;dashed&#x27;</span>,</span><br><span class="line">                arrow=arrow(<span class="built_in">length</span>=unit(<span class="number">0.02</span>, <span class="string">&quot;npc&quot;</span>)))</span><br><span class="line"></span><br><span class="line">p2 &lt;- ggtree(tree, layout=<span class="string">&quot;circular&quot;</span>) + </span><br><span class="line">  geom_taxalink(taxa1=<span class="string">&#x27;A&#x27;</span>, taxa2=<span class="string">&#x27;E&#x27;</span>, </span><br><span class="line">                color=<span class="string">&quot;grey&quot;</span>,alpha=<span class="number">0.5</span>, </span><br><span class="line">                offset=<span class="number">0.05</span>,arrow=arrow(<span class="built_in">length</span>=unit(<span class="number">0.01</span>, <span class="string">&quot;npc&quot;</span>))) + </span><br><span class="line">  geom_taxalink(taxa1=<span class="string">&#x27;F&#x27;</span>, taxa2=<span class="string">&#x27;K&#x27;</span>, </span><br><span class="line">                color=<span class="string">&#x27;red&#x27;</span>, linetype = <span class="string">&#x27;dashed&#x27;</span>, </span><br><span class="line">                alpha=<span class="number">0.5</span>, offset=<span class="number">0.05</span>,</span><br><span class="line">                arrow=arrow(<span class="built_in">length</span>=unit(<span class="number">0.01</span>, <span class="string">&quot;npc&quot;</span>))) +</span><br><span class="line">  geom_taxalink(taxa1=<span class="string">&quot;L&quot;</span>, taxa2=<span class="string">&quot;M&quot;</span>, </span><br><span class="line">                color=<span class="string">&quot;blue&quot;</span>, alpha=<span class="number">0.5</span>, </span><br><span class="line">                offset=<span class="number">0.05</span>,hratio=<span class="number">0.8</span>, </span><br><span class="line">                arrow=arrow(<span class="built_in">length</span>=unit(<span class="number">0.01</span>, <span class="string">&quot;npc&quot;</span>))) + </span><br><span class="line">  geom_tiplab()</span><br><span class="line"></span><br><span class="line"><span class="comment"># when the tree was created using reverse x, </span></span><br><span class="line"><span class="comment"># we can set outward to FALSE, which will generate the inward curve lines.</span></span><br><span class="line">p3 &lt;- ggtree(tree, layout=<span class="string">&quot;inward_circular&quot;</span>, xlim=<span class="number">150</span>) +</span><br><span class="line">  geom_taxalink(taxa1=<span class="string">&#x27;A&#x27;</span>, taxa2=<span class="string">&#x27;E&#x27;</span>, </span><br><span class="line">                color=<span class="string">&quot;grey&quot;</span>, alpha=<span class="number">0.5</span>, </span><br><span class="line">                offset=-<span class="number">0.2</span>, </span><br><span class="line">                outward=<span class="literal">FALSE</span>,</span><br><span class="line">                arrow=arrow(<span class="built_in">length</span>=unit(<span class="number">0.01</span>, <span class="string">&quot;npc&quot;</span>))) +</span><br><span class="line">  geom_taxalink(taxa1=<span class="string">&#x27;F&#x27;</span>, taxa2=<span class="string">&#x27;K&#x27;</span>, </span><br><span class="line">                color=<span class="string">&#x27;red&#x27;</span>, linetype = <span class="string">&#x27;dashed&#x27;</span>, </span><br><span class="line">                alpha=<span class="number">0.5</span>, offset=-<span class="number">0.2</span>,</span><br><span class="line">                outward=<span class="literal">FALSE</span>,</span><br><span class="line">                arrow=arrow(<span class="built_in">length</span>=unit(<span class="number">0.01</span>, <span class="string">&quot;npc&quot;</span>))) +</span><br><span class="line">  geom_taxalink(taxa1=<span class="string">&quot;L&quot;</span>, taxa2=<span class="string">&quot;M&quot;</span>, </span><br><span class="line">                color=<span class="string">&quot;blue&quot;</span>, alpha=<span class="number">0.5</span>, </span><br><span class="line">                offset=-<span class="number">0.2</span>, </span><br><span class="line">                outward=<span class="literal">FALSE</span>,</span><br><span class="line">                arrow=arrow(<span class="built_in">length</span>=unit(<span class="number">0.01</span>, <span class="string">&quot;npc&quot;</span>))) +</span><br><span class="line">  geom_tiplab(hjust=<span class="number">1</span>) </span><br><span class="line"></span><br><span class="line">dat &lt;- data.frame(from=<span class="built_in">c</span>(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;F&quot;</span>, <span class="string">&quot;L&quot;</span>), </span><br><span class="line">                  to=<span class="built_in">c</span>(<span class="string">&quot;E&quot;</span>, <span class="string">&quot;K&quot;</span>, <span class="string">&quot;M&quot;</span>), </span><br><span class="line">                  h=<span class="built_in">c</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0.1</span>), </span><br><span class="line">                  type=<span class="built_in">c</span>(<span class="string">&quot;t1&quot;</span>, <span class="string">&quot;t2&quot;</span>, <span class="string">&quot;t3&quot;</span>), </span><br><span class="line">                  s=<span class="built_in">c</span>(<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">p4 &lt;- ggtree(tree, layout=<span class="string">&quot;inward_circular&quot;</span>, xlim=<span class="built_in">c</span>(<span class="number">150</span>, <span class="number">0</span>)) +</span><br><span class="line">  geom_taxalink(data=dat, </span><br><span class="line">                mapping=aes(taxa1=from, </span><br><span class="line">                            taxa2=to, </span><br><span class="line">                            color=type, </span><br><span class="line">                            size=s), </span><br><span class="line">                ncp=<span class="number">10</span>,</span><br><span class="line">                offset=<span class="number">0.15</span>) + </span><br><span class="line">  geom_tiplab(hjust=<span class="number">1</span>) +</span><br><span class="line">  scale_size_continuous(<span class="built_in">range</span>=<span class="built_in">c</span>(<span class="number">1</span>,<span class="number">3</span>))</span><br><span class="line">cowplot::plot_grid(p1, p2, p3, p4, ncol=<span class="number">2</span>, labels=<span class="built_in">LETTERS</span>[<span class="number">1</span>:<span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/32.png" class="">

<h2 id="Uncertainty-of-evolutionary-inference"><a href="#Uncertainty-of-evolutionary-inference" class="headerlink" title="Uncertainty of evolutionary inference"></a>Uncertainty of evolutionary inference</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">file &lt;- system.file(<span class="string">&quot;extdata/MEGA7&quot;</span>, <span class="string">&quot;mtCDNA_timetree.nex&quot;</span>, package = <span class="string">&quot;treeio&quot;</span>)</span><br><span class="line">x &lt;- read.mega(file)</span><br><span class="line">p1 &lt;- ggtree(x) + geom_range(<span class="string">&#x27;reltime_0.95_CI&#x27;</span>, color=<span class="string">&#x27;red&#x27;</span>, size=<span class="number">3</span>, alpha=<span class="number">.3</span>)</span><br><span class="line">p2 &lt;- ggtree(x) + geom_range(<span class="string">&#x27;reltime_0.95_CI&#x27;</span>, color=<span class="string">&#x27;red&#x27;</span>, size=<span class="number">3</span>, alpha=<span class="number">.3</span>, center=<span class="string">&#x27;reltime&#x27;</span>)  </span><br><span class="line">p3 &lt;- p2 + scale_x_range() + theme_tree2()</span><br><span class="line"></span><br><span class="line">cowplot::plot_grid(p1,p2,p3,ncol = <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/33.png" class="">

<h2 id="其他软件输出的结果"><a href="#其他软件输出的结果" class="headerlink" title="其他软件输出的结果"></a>其他软件输出的结果</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rstfile &lt;- system.file(<span class="string">&quot;extdata/PAML_Codeml&quot;</span>, <span class="string">&quot;rst&quot;</span>, </span><br><span class="line">                       package=<span class="string">&quot;treeio&quot;</span>)</span><br><span class="line">mlcfile &lt;- system.file(<span class="string">&quot;extdata/PAML_Codeml&quot;</span>, <span class="string">&quot;mlc&quot;</span>, </span><br><span class="line">                       package=<span class="string">&quot;treeio&quot;</span>)</span><br><span class="line"></span><br><span class="line">ml &lt;- read.codeml(rstfile, mlcfile)</span><br><span class="line">ggtree(ml, aes(color=dN_vs_dS), branch.length=<span class="string">&#x27;dN_vs_dS&#x27;</span>) + </span><br><span class="line">  scale_color_continuous(name=<span class="string">&#x27;dN/dS&#x27;</span>, limits=<span class="built_in">c</span>(<span class="number">0</span>, <span class="number">1.5</span>),</span><br><span class="line">                         oob=scales::squish,</span><br><span class="line">                         low=<span class="string">&#x27;darkgreen&#x27;</span>, high=<span class="string">&#x27;red&#x27;</span>) +</span><br><span class="line">  geom_text(aes(x=branch, label=AA_subs), </span><br><span class="line">            vjust=-<span class="number">.5</span>, color=<span class="string">&#x27;steelblue&#x27;</span>, size=<span class="number">2</span>) +</span><br><span class="line">  theme_tree2(legend.position=<span class="built_in">c</span>(<span class="number">.9</span>, <span class="number">.3</span>))</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/34.png" class="">

<h2 id="放大特定区域"><a href="#放大特定区域" class="headerlink" title="放大特定区域"></a>放大特定区域</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">library(ggtree)</span><br><span class="line">nwk &lt;- system.file(<span class="string">&quot;extdata&quot;</span>, <span class="string">&quot;sample.nwk&quot;</span>, package=<span class="string">&quot;treeio&quot;</span>)</span><br><span class="line">tree &lt;- read.tree(nwk)</span><br><span class="line">p1 = ggtree(tree) + geom_tiplab()</span><br><span class="line">p2 = viewClade(p, MRCA(p, <span class="string">&quot;I&quot;</span>, <span class="string">&quot;L&quot;</span>))</span><br><span class="line"></span><br><span class="line">cowplot::plot_grid(p1,p2,ncol = <span class="number">2</span>, labels = <span class="built_in">c</span>(<span class="string">&#x27;原图&#x27;</span>,<span class="string">&#x27;特定区域&#x27;</span>))</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/35.png" class="">

<h2 id="标准化选中的clade"><a href="#标准化选中的clade" class="headerlink" title="标准化选中的clade"></a>标准化选中的clade</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tree2 &lt;- groupClade(tree, <span class="built_in">c</span>(<span class="number">17</span>, <span class="number">21</span>))</span><br><span class="line">p &lt;- ggtree(tree2, aes(color=group)) + theme(legend.position=<span class="string">&#x27;none&#x27;</span>) +</span><br><span class="line">  scale_color_manual(values=<span class="built_in">c</span>(<span class="string">&quot;black&quot;</span>, <span class="string">&quot;firebrick&quot;</span>, <span class="string">&quot;steelblue&quot;</span>))</span><br><span class="line">scaleClade(p, node=<span class="number">17</span>, scale=<span class="number">.1</span>) </span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/36.png" class="">

<h2 id="隐藏-展示某个clade"><a href="#隐藏-展示某个clade" class="headerlink" title="隐藏/展示某个clade"></a>隐藏/展示某个clade</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p2 &lt;- p %&gt;% collapse(node=<span class="number">21</span>) + </span><br><span class="line">  geom_point2(aes(subset=(node==<span class="number">21</span>)), shape=<span class="number">21</span>, size=<span class="number">5</span>, fill=<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line">p2 &lt;- collapse(p2, node=<span class="number">23</span>) + </span><br><span class="line">  geom_point2(aes(subset=(node==<span class="number">23</span>)), shape=<span class="number">23</span>, size=<span class="number">5</span>, fill=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">print(p2)</span><br><span class="line">expand(p2, node=<span class="number">23</span>) %&gt;% expand(node=<span class="number">21</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/37.png" class="">

<h2 id="利用三角形隐藏-展示某个clade"><a href="#利用三角形隐藏-展示某个clade" class="headerlink" title="利用三角形隐藏/展示某个clade"></a>利用三角形隐藏/展示某个clade</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">p2 &lt;- p + geom_tiplab()</span><br><span class="line">node &lt;- 21</span><br><span class="line">collapse(p2, node, <span class="string">&#x27;max&#x27;</span>) %&gt;% expand(node)</span><br><span class="line">collapse(p2, node, <span class="string">&#x27;min&#x27;</span>) %&gt;% expand(node)</span><br><span class="line">collapse(p2, node, <span class="string">&#x27;mixed&#x27;</span>) %&gt;% expand(node)</span><br><span class="line"></span><br><span class="line">collapse(p, <span class="number">21</span>, <span class="string">&#x27;mixed&#x27;</span>, fill=<span class="string">&#x27;steelblue&#x27;</span>, alpha=<span class="number">.4</span>) %&gt;% </span><br><span class="line">  collapse(<span class="number">23</span>, <span class="string">&#x27;mixed&#x27;</span>, fill=<span class="string">&#x27;firebrick&#x27;</span>, color=<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">scaleClade(p, <span class="number">23</span>, <span class="number">.2</span>) %&gt;% collapse(<span class="number">23</span>, <span class="string">&#x27;min&#x27;</span>, fill=<span class="string">&quot;darkgreen&quot;</span>)  </span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/38.png" class="">

<h2 id="分组Taxa"><a href="#分组Taxa" class="headerlink" title="分组Taxa"></a>分组Taxa</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">library(ggsci)</span><br><span class="line"></span><br><span class="line">data(iris)</span><br><span class="line">rn &lt;- paste0(iris[,<span class="number">5</span>], <span class="string">&quot;_&quot;</span>, <span class="number">1</span>:<span class="number">150</span>)</span><br><span class="line">rownames(iris) &lt;- rn</span><br><span class="line">d_iris &lt;- dist(iris[,-<span class="number">5</span>], method=<span class="string">&quot;man&quot;</span>)</span><br><span class="line"></span><br><span class="line">c &lt;- ape::bionj(d_iris)</span><br><span class="line">grp &lt;- <span class="built_in">list</span>(setosa     = rn[<span class="number">1</span>:<span class="number">50</span>],</span><br><span class="line">            versicolor = rn[<span class="number">51</span>:<span class="number">100</span>],</span><br><span class="line">            virginica  = rn[<span class="number">101</span>:<span class="number">150</span>])</span><br><span class="line"></span><br><span class="line">p_iris &lt;- ggtree(tree_iris, layout = <span class="string">&#x27;circular&#x27;</span>, branch.length=<span class="string">&#x27;none&#x27;</span>)</span><br><span class="line">groupOTU(p_iris, grp, <span class="string">&#x27;group&#x27;</span>) + </span><br><span class="line">  aes(color=group) +</span><br><span class="line">  scale_color_aaas() +</span><br><span class="line">  theme(legend.position=<span class="string">&quot;right&quot;</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/39.png" class="">

<p>另外一种方法：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tree_iris &lt;- groupOTU(tree_iris, grp, <span class="string">&quot;Species&quot;</span>)</span><br><span class="line">ggtree(tree_iris, aes(color=Species), layout = <span class="string">&#x27;circular&#x27;</span>, branch.length = <span class="string">&#x27;none&#x27;</span>) + </span><br><span class="line">  theme(legend.position=<span class="string">&quot;right&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="旋转clade"><a href="#旋转clade" class="headerlink" title="旋转clade"></a>旋转clade</h2><p>旋转<code>clade</code>有两种方法：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p1 &lt;- p + geom_point2(aes(subset=node==<span class="number">16</span>), color=<span class="string">&#x27;darkgreen&#x27;</span>, size=<span class="number">5</span>)</span><br><span class="line">p2 &lt;- rotate(p1, <span class="number">17</span>) %&gt;% rotate(<span class="number">21</span>) <span class="comment"># 方法1</span></span><br><span class="line">flip(p2, <span class="number">17</span>, <span class="number">21</span>) <span class="comment"># 方法2</span></span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/40.png" class="">

<h2 id="外部数据mapping到树上"><a href="#外部数据mapping到树上" class="headerlink" title="外部数据mapping到树上"></a>外部数据mapping到树上</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">library(ggimage)</span><br><span class="line">library(ggtree)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件下载地址</span></span><br><span class="line"><span class="comment"># https://raw.githubusercontent.com/YuLab-SMU/treedata-book/master/data/tree_boots.nwk</span></span><br><span class="line"><span class="comment"># https://raw.githubusercontent.com/YuLab-SMU/treedata-book/master/data/tip_data.csv</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x &lt;- read.tree(<span class="string">&quot;tree_boots.nwk&quot;</span>)</span><br><span class="line">info &lt;- read.csv(<span class="string">&quot;tip_data.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line">p &lt;- ggtree(x) %&lt;+% info + xlim(-<span class="number">.1</span>, <span class="number">4</span>)</span><br><span class="line">p2 &lt;- p + geom_tiplab(offset = <span class="number">.6</span>, hjust = <span class="number">.5</span>) +</span><br><span class="line">  geom_tippoint(aes(shape = trophic_habit, color = trophic_habit, size = mass_in_kg)) + </span><br><span class="line">  theme(legend.position = <span class="string">&quot;right&quot;</span>) + scale_size_continuous(<span class="built_in">range</span> = <span class="built_in">c</span>(<span class="number">3</span>, <span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#https://raw.githubusercontent.com/YuLab-SMU/treedata-book/master/data/inode_data.csv</span></span><br><span class="line">d2 &lt;- read.csv(<span class="string">&quot;inode_data.csv&quot;</span>)</span><br><span class="line">p2 %&lt;+% d2 + geom_label(aes(label = vernacularName.y, fill = posterior)) + </span><br><span class="line">  scale_fill_gradientn(colors = RColorBrewer::brewer.pal(<span class="number">3</span>, <span class="string">&quot;YlGnBu&quot;</span>))</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/41.png" class="">

<h2 id="将SNP数据添加到树上"><a href="#将SNP数据添加到树上" class="headerlink" title="将SNP数据添加到树上"></a>将SNP数据添加到树上</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">library(ggtree)</span><br><span class="line"><span class="comment">## remote_folder &lt;- paste0(&quot;https://raw.githubusercontent.com/katholt/&quot;,</span></span><br><span class="line"><span class="comment">##                         &quot;plotTree/master/tree_example_april2015/&quot;)</span></span><br><span class="line">remote_folder &lt;- <span class="string">&quot;data/tree_example_april2015/&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">## read the phylogenetic tree</span></span><br><span class="line">tree &lt;- read.tree(paste0(remote_folder, <span class="string">&quot;tree.nwk&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">## read the sampling information data set</span></span><br><span class="line">info &lt;- read.csv(paste0(remote_folder,<span class="string">&quot;info.csv&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">## read and process the allele table</span></span><br><span class="line">snps&lt;-read.csv(paste0(remote_folder, <span class="string">&quot;alleles.csv&quot;</span>), header = <span class="built_in">F</span>,</span><br><span class="line">                row.names = <span class="number">1</span>, stringsAsFactor = <span class="built_in">F</span>)</span><br><span class="line">snps_strainCols &lt;- snps[<span class="number">1</span>,] </span><br><span class="line">snps&lt;-snps[-<span class="number">1</span>,] <span class="comment"># drop strain names</span></span><br><span class="line">colnames(snps) &lt;- snps_strainCols</span><br><span class="line"></span><br><span class="line">gapChar &lt;- <span class="string">&quot;?&quot;</span></span><br><span class="line">snp &lt;- t(snps)</span><br><span class="line">lsnp &lt;- apply(snp, <span class="number">1</span>, <span class="keyword">function</span>(x) &#123;</span><br><span class="line">        x != snp[<span class="number">1</span>,] &amp; x != gapChar &amp; snp[<span class="number">1</span>,] != gapChar</span><br><span class="line">    &#125;)</span><br><span class="line">lsnp &lt;- as.data.frame(lsnp)</span><br><span class="line">lsnp$pos &lt;- <span class="built_in">as.numeric</span>(rownames(lsnp))</span><br><span class="line">lsnp &lt;- tidyr::gather(lsnp, name, value, -pos)</span><br><span class="line">snp_data &lt;- lsnp[lsnp$value, <span class="built_in">c</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;pos&quot;</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment">## read the trait data</span></span><br><span class="line">bar_data &lt;- read.csv(paste0(remote_folder, <span class="string">&quot;bar.csv&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">## visualize the tree </span></span><br><span class="line">p &lt;- ggtree(tree) </span><br><span class="line"></span><br><span class="line"><span class="comment">## attach the sampling information data set </span></span><br><span class="line"><span class="comment">## and add symbols colored by location</span></span><br><span class="line">p &lt;- p %&lt;+% info + geom_tippoint(aes(color=location))</span><br><span class="line"></span><br><span class="line"><span class="comment">## visualize SNP and Trait data using dot and bar charts,</span></span><br><span class="line"><span class="comment">## and align them based on tree structure</span></span><br><span class="line">p + geom_facet(panel = <span class="string">&quot;SNP&quot;</span>, data = snp_data, geom = geom_point, </span><br><span class="line">               mapping=aes(x = pos, color = location), shape = <span class="string">&#x27;|&#x27;</span>) +</span><br><span class="line">    geom_facet(panel = <span class="string">&quot;Trait&quot;</span>, data = bar_data, geom = ggstance::geom_barh, </span><br><span class="line">                aes(x = dummy_bar_value, color = location, fill = location), </span><br><span class="line">                stat = <span class="string">&quot;identity&quot;</span>, width = <span class="number">.6</span>) +</span><br><span class="line">    theme_tree2(legend.position=<span class="built_in">c</span>(<span class="number">.05</span>, <span class="number">.85</span>))</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/42.png" class="">

<h2 id="关联矩阵"><a href="#关联矩阵" class="headerlink" title="关联矩阵"></a>关联矩阵</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">beast_file &lt;- system.file(<span class="string">&quot;examples/MCC_FluA_H3.tree&quot;</span>, package=<span class="string">&quot;ggtree&quot;</span>)</span><br><span class="line">beast_tree &lt;- read.beast(beast_file)</span><br><span class="line"></span><br><span class="line">genotype_file &lt;- system.file(<span class="string">&quot;examples/Genotype.txt&quot;</span>, package=<span class="string">&quot;ggtree&quot;</span>)</span><br><span class="line">genotype &lt;- read.table(genotype_file, sep=<span class="string">&quot;\t&quot;</span>, stringsAsFactor=<span class="built_in">F</span>)</span><br><span class="line">colnames(genotype) &lt;- sub(<span class="string">&quot;\\.$&quot;</span>, <span class="string">&quot;&quot;</span>, colnames(genotype))</span><br><span class="line">p &lt;- ggtree(beast_tree, mrsd=<span class="string">&quot;2013-01-01&quot;</span>) + </span><br><span class="line">    geom_treescale(x=<span class="number">2008</span>, y=<span class="number">1</span>, offset=<span class="number">2</span>) + </span><br><span class="line">    geom_tiplab(size=<span class="number">2</span>)</span><br><span class="line">gheatmap(p, genotype, offset=<span class="number">5</span>, width=<span class="number">0.5</span>, font.size=<span class="number">3</span>, </span><br><span class="line">        colnames_angle=-<span class="number">45</span>, hjust=<span class="number">0</span>) +</span><br><span class="line">    scale_fill_manual(breaks=<span class="built_in">c</span>(<span class="string">&quot;HuH3N2&quot;</span>, <span class="string">&quot;pdm&quot;</span>, <span class="string">&quot;trig&quot;</span>), </span><br><span class="line">        values=<span class="built_in">c</span>(<span class="string">&quot;steelblue&quot;</span>, <span class="string">&quot;firebrick&quot;</span>, <span class="string">&quot;darkgreen&quot;</span>), name=<span class="string">&quot;genotype&quot;</span>)</span><br><span class="line"></span><br><span class="line">p &lt;- ggtree(beast_tree, mrsd=<span class="string">&quot;2013-01-01&quot;</span>) + </span><br><span class="line">    geom_tiplab(size=<span class="number">2</span>, align=<span class="literal">TRUE</span>, linesize=<span class="number">.5</span>) + </span><br><span class="line">    theme_tree2()</span><br><span class="line">gheatmap(p, genotype, offset=<span class="number">8</span>, width=<span class="number">0.6</span>, </span><br><span class="line">        colnames=<span class="literal">FALSE</span>, legend_title=<span class="string">&quot;genotype&quot;</span>) +</span><br><span class="line">    scale_x_ggtree() + </span><br><span class="line">    scale_y_continuous(expand=<span class="built_in">c</span>(<span class="number">0</span>, <span class="number">0.3</span>))</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/43.png" class="">

<h2 id="关联多个矩阵"><a href="#关联多个矩阵" class="headerlink" title="关联多个矩阵"></a>关联多个矩阵</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">nwk &lt;- system.file(<span class="string">&quot;extdata&quot;</span>, <span class="string">&quot;sample.nwk&quot;</span>, package=<span class="string">&quot;treeio&quot;</span>)</span><br><span class="line"></span><br><span class="line">tree &lt;- read.tree(nwk)</span><br><span class="line">circ &lt;- ggtree(tree, layout = <span class="string">&quot;circular&quot;</span>)</span><br><span class="line"></span><br><span class="line">df &lt;- data.frame(first=<span class="built_in">c</span>(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;f&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;f&quot;</span>),</span><br><span class="line">                 second= <span class="built_in">c</span>(<span class="string">&quot;z&quot;</span>, <span class="string">&quot;z&quot;</span>, <span class="string">&quot;z&quot;</span>, <span class="string">&quot;z&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;a&quot;</span>))</span><br><span class="line">rownames(df) &lt;- tree$tip.label</span><br><span class="line"></span><br><span class="line">df2 &lt;- as.data.frame(matrix(rnorm(<span class="number">39</span>), ncol=<span class="number">3</span>))</span><br><span class="line">rownames(df2) &lt;- tree$tip.label</span><br><span class="line">colnames(df2) &lt;- <span class="built_in">LETTERS</span>[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 &lt;- gheatmap(circ, df, offset=<span class="number">.8</span>, width=<span class="number">.2</span>,</span><br><span class="line">               colnames_angle=<span class="number">95</span>, colnames_offset_y = <span class="number">.25</span>) +</span><br><span class="line">    scale_fill_viridis_d(option=<span class="string">&quot;D&quot;</span>, name=<span class="string">&quot;discrete\nvalue&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">library(ggnewscale)</span><br><span class="line">p2 &lt;- p1 + new_scale_fill()</span><br><span class="line">gheatmap(p2, df2, offset=<span class="number">15</span>, width=<span class="number">.3</span>,</span><br><span class="line">         colnames_angle=<span class="number">90</span>, colnames_offset_y = <span class="number">.25</span>) +</span><br><span class="line">    scale_fill_viridis_c(option=<span class="string">&quot;A&quot;</span>, name=<span class="string">&quot;continuous\nvalue&quot;</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/44.png" class="">

<h2 id="多序列比对可视化"><a href="#多序列比对可视化" class="headerlink" title="多序列比对可视化"></a>多序列比对可视化</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tree &lt;- read.tree(<span class="string">&quot;data/tree.nwk&quot;</span>)</span><br><span class="line">p &lt;- ggtree(tree) + geom_tiplab(size=<span class="number">3</span>)</span><br><span class="line">msaplot(p, <span class="string">&quot;data/sequence.fasta&quot;</span>, offset=<span class="number">3</span>, width=<span class="number">2</span>)</span><br><span class="line">p &lt;- ggtree(tree, layout=<span class="string">&#x27;circular&#x27;</span>) + </span><br><span class="line">    geom_tiplab(offset=<span class="number">4</span>, align=<span class="literal">TRUE</span>) + xlim(<span class="literal">NA</span>, <span class="number">12</span>)</span><br><span class="line">msaplot(p, <span class="string">&quot;data/sequence.fasta&quot;</span>, window=<span class="built_in">c</span>(<span class="number">120</span>, <span class="number">200</span>))  </span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/45.png" class="">

<h2 id="拼图"><a href="#拼图" class="headerlink" title="拼图"></a>拼图</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">library(ggplot2)</span><br><span class="line">library(ggtree)</span><br><span class="line"></span><br><span class="line">set.seed(<span class="number">2019</span>-<span class="number">10</span>-<span class="number">31</span>)</span><br><span class="line">tr &lt;- rtree(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">d1 &lt;- data.frame(</span><br><span class="line">    <span class="comment"># only some labels match</span></span><br><span class="line">    label = <span class="built_in">c</span>(tr$tip.label[sample(<span class="number">5</span>, <span class="number">5</span>)], <span class="string">&quot;A&quot;</span>),</span><br><span class="line">    value = sample(<span class="number">1</span>:<span class="number">6</span>, <span class="number">6</span>))</span><br><span class="line"></span><br><span class="line">d2 &lt;- data.frame(</span><br><span class="line">    label = <span class="built_in">rep</span>(tr$tip.label, <span class="number">5</span>),</span><br><span class="line">    category = <span class="built_in">rep</span>(<span class="built_in">LETTERS</span>[<span class="number">1</span>:<span class="number">5</span>], each=<span class="number">10</span>),</span><br><span class="line">    value = rnorm(<span class="number">50</span>, <span class="number">0</span>, <span class="number">3</span>)) </span><br><span class="line"></span><br><span class="line">g &lt;- ggtree(tr) + geom_tiplab(align=<span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line">p1 &lt;- ggplot(d1, aes(label, value)) + geom_col(aes(fill=label)) + </span><br><span class="line">    geom_text(aes(label=label, y= value+<span class="number">.1</span>)) +</span><br><span class="line">    coord_flip() + theme_tree2() + theme(legend.position=<span class="string">&#x27;none&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">p2 &lt;- ggplot(d2, aes(x=category, y=label)) + </span><br><span class="line">    geom_tile(aes(fill=value)) + scale_fill_viridis_c() + </span><br><span class="line">    theme_tree2() </span><br><span class="line">    </span><br><span class="line">cowplot::plot_grid(g, p2, p1, ncol=<span class="number">3</span>) </span><br><span class="line"></span><br><span class="line">library(aplot)</span><br><span class="line">p2 %&gt;% insert_left(g) %&gt;% insert_right(p1, width=<span class="number">.5</span>) </span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/46.png" class="">

<h2 id="图片注释"><a href="#图片注释" class="headerlink" title="图片注释"></a>图片注释</h2><p>没能找到图片下载地址，看代码很容易理解：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">library(ggimage)</span><br><span class="line">library(ggtree)</span><br><span class="line"></span><br><span class="line">nwk &lt;- <span class="string">&quot;((((bufonidae, dendrobatidae), ceratophryidae), (centrolenidae, leptodactylidae)), hylidae);&quot;</span></span><br><span class="line"></span><br><span class="line">x = read.tree(text = nwk)</span><br><span class="line">ggtree(x) + xlim(<span class="literal">NA</span>, <span class="number">7</span>) + ylim(<span class="literal">NA</span>, <span class="number">6.2</span>) +</span><br><span class="line">  geom_tiplab(aes(image=paste0(<span class="string">&quot;img/frogs/&quot;</span>, label, <span class="string">&#x27;.jpg&#x27;</span>)), </span><br><span class="line">              geom=<span class="string">&quot;image&quot;</span>, offset=<span class="number">2</span>, align=<span class="number">2</span>, size=<span class="number">.2</span>)  + </span><br><span class="line">  geom_tiplab(geom=<span class="string">&#x27;label&#x27;</span>, offset=<span class="number">1</span>, hjust=<span class="number">.5</span>) + </span><br><span class="line">  geom_image(x=<span class="number">.8</span>, y=<span class="number">5.5</span>, image=<span class="string">&quot;img/frogs/frog.jpg&quot;</span>, size=<span class="number">.2</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/47.png" class="">

<h2 id="图标（剪影）注释"><a href="#图标（剪影）注释" class="headerlink" title="图标（剪影）注释"></a>图标（剪影）注释</h2><p><a target="_blank" rel="noopener" href="http://phylopic.org/">PhyloPic</a>提供了1300余种生物剪影，<code>ggtree</code>能够调用这个数据库中的生物图标进行注释，相当于上面的图片。这种情况下绘图稍微有点慢，毕竟这个数据库是国外的。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">library(ggtree)</span><br><span class="line">newick &lt;- <span class="string">&quot;((Pongo_abelii,(Gorilla_gorilla_gorilla,(Pan_paniscus,Pan_troglodytes)Pan,Homo_sapiens)Homininae)Hominidae,Nomascus_leucogenys)Hominoidea;&quot;</span></span><br><span class="line"></span><br><span class="line">tree &lt;- read.tree(text=newick)</span><br><span class="line"></span><br><span class="line">d &lt;- ggimage::phylopic_uid(tree$tip.label)</span><br><span class="line">d$body_mass = <span class="built_in">c</span>(<span class="number">52</span>, <span class="number">114</span>, <span class="number">47</span>, <span class="number">45</span>, <span class="number">58</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">p &lt;- ggtree(tree) %&lt;+% d + </span><br><span class="line">  geom_tiplab(aes(image=uid, colour=body_mass), geom=<span class="string">&quot;phylopic&quot;</span>, offset=<span class="number">2.5</span>) +</span><br><span class="line">  geom_tiplab(aes(label=label), offset = <span class="number">.2</span>) + xlim(<span class="literal">NA</span>, <span class="number">7</span>) +</span><br><span class="line">  scale_color_viridis_c()</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/48.png" class="">

<h2 id="使用子图进行注释"><a href="#使用子图进行注释" class="headerlink" title="使用子图进行注释"></a>使用子图进行注释</h2><p>用子图进行注释是通过函数<code>geom_inset()</code>来完成的。</p>
<h3 id="条形图注释"><a href="#条形图注释" class="headerlink" title="条形图注释"></a>条形图注释</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">library(phytools)</span><br><span class="line">data(anoletree)</span><br><span class="line">x &lt;- getStates(anoletree,<span class="string">&quot;tips&quot;</span>)</span><br><span class="line">tree &lt;- anoletree</span><br><span class="line"></span><br><span class="line">cols &lt;- setNames(palette()[<span class="number">1</span>:<span class="built_in">length</span>(unique(x))],sort(unique(x)))</span><br><span class="line">fitER &lt;- ape::ace(x,tree,model=<span class="string">&quot;ER&quot;</span>,type=<span class="string">&quot;discrete&quot;</span>)</span><br><span class="line">ancstats &lt;- as.data.frame(fitER$lik.anc)</span><br><span class="line">ancstats$node &lt;- 1:tree$Nnode+Ntip(tree)</span><br><span class="line"></span><br><span class="line"><span class="comment">## cols parameter indicate which columns store stats</span></span><br><span class="line">bars &lt;- nodebar(ancstats, cols=<span class="number">1</span>:<span class="number">6</span>)</span><br><span class="line">bars &lt;- lapply(bars, <span class="keyword">function</span>(g) g+scale_fill_manual(values = cols))</span><br><span class="line"></span><br><span class="line">tree2 &lt;- full_join(tree, data.frame(label = <span class="built_in">names</span>(x), stat = x ), by = <span class="string">&#x27;label&#x27;</span>)</span><br><span class="line">p &lt;- ggtree(tree2) + geom_tiplab() +</span><br><span class="line">    geom_tippoint(aes(color = stat)) + </span><br><span class="line">    scale_color_manual(values = cols) +</span><br><span class="line">    theme(legend.position = <span class="string">&quot;right&quot;</span>) + </span><br><span class="line">    xlim(<span class="literal">NA</span>, <span class="number">8</span>)</span><br><span class="line">p + geom_inset(bars, width = <span class="number">.08</span>, height = <span class="number">.05</span>, x = <span class="string">&quot;branch&quot;</span>) </span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/49.png" class="">

<h3 id="饼图注释"><a href="#饼图注释" class="headerlink" title="饼图注释"></a>饼图注释</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">library(phytools)</span><br><span class="line">library(treeio)</span><br><span class="line">library(tidytree)</span><br><span class="line">data(anoletree)</span><br><span class="line">x &lt;- getStates(anoletree,<span class="string">&quot;tips&quot;</span>)</span><br><span class="line">tree &lt;- anoletree</span><br><span class="line"></span><br><span class="line">cols &lt;- setNames(palette()[<span class="number">1</span>:<span class="built_in">length</span>(unique(x))],sort(unique(x)))</span><br><span class="line">fitER &lt;- ape::ace(x,tree,model=<span class="string">&quot;ER&quot;</span>,type=<span class="string">&quot;discrete&quot;</span>)</span><br><span class="line">ancstats &lt;- as.data.frame(fitER$lik.anc)</span><br><span class="line">ancstats$node &lt;- 1:tree$Nnode+Ntip(tree)</span><br><span class="line"></span><br><span class="line">pies &lt;- nodepie(ancstats, cols = <span class="number">1</span>:<span class="number">6</span>)</span><br><span class="line">pies &lt;- lapply(pies, <span class="keyword">function</span>(g) g+scale_fill_manual(values = cols))</span><br><span class="line"></span><br><span class="line">tree2 &lt;- full_join(tree, data.frame(label = <span class="built_in">names</span>(x), stat = x ), by = <span class="string">&#x27;label&#x27;</span>)</span><br><span class="line">p &lt;- ggtree(tree2) + geom_tiplab() +</span><br><span class="line">  geom_tippoint(aes(color = stat)) + </span><br><span class="line">  scale_color_manual(values = cols) +</span><br><span class="line">  theme(legend.position = <span class="string">&quot;right&quot;</span>) + </span><br><span class="line">  xlim(<span class="literal">NA</span>, <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">p + geom_inset(pies, width = <span class="number">.1</span>, height = <span class="number">.1</span>) </span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/50.png" class="">

<h3 id="多种图像组合注释"><a href="#多种图像组合注释" class="headerlink" title="多种图像组合注释"></a>多种图像组合注释</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pies_and_bars &lt;- pies</span><br><span class="line">i &lt;- sample(length(pies), 20)</span><br><span class="line">pies_and_bars[i] &lt;- bars[i]</span><br><span class="line">p + geom_inset(pies_and_bars, width=.08, height=.05)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/51.png" class="">

<h2 id="Phylomoji注释"><a href="#Phylomoji注释" class="headerlink" title="Phylomoji注释"></a><code>Phylomoji</code>注释</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">library(ggplot2)</span><br><span class="line">library(ggtree)</span><br><span class="line"><span class="comment"># install.packages(&#x27;emojifont&#x27;)</span></span><br><span class="line"></span><br><span class="line">tt = <span class="string">&#x27;((snail,mushroom),(((sunflower,evergreen_tree),leaves),green_salad));&#x27;</span></span><br><span class="line">tree = read.tree(text = tt)</span><br><span class="line">d &lt;- data.frame(label = <span class="built_in">c</span>(<span class="string">&#x27;snail&#x27;</span>,<span class="string">&#x27;mushroom&#x27;</span>, <span class="string">&#x27;sunflower&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;evergreen_tree&#x27;</span>,<span class="string">&#x27;leaves&#x27;</span>, <span class="string">&#x27;green_salad&#x27;</span>),</span><br><span class="line">                group = <span class="built_in">c</span>(<span class="string">&#x27;animal&#x27;</span>, <span class="string">&#x27;fungi&#x27;</span>, <span class="string">&#x27;flowering plant&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;conifers&#x27;</span>, <span class="string">&#x27;ferns&#x27;</span>, <span class="string">&#x27;mosses&#x27;</span>))</span><br><span class="line"></span><br><span class="line">ggtree(tree, linetype = <span class="string">&quot;dashed&quot;</span>, size=<span class="number">1</span>, color=<span class="string">&#x27;firebrick&#x27;</span>) %&lt;+% d + </span><br><span class="line">  xlim(<span class="number">0</span>, <span class="number">4.5</span>) + ylim(<span class="number">0.5</span>, <span class="number">6.5</span>) +</span><br><span class="line">  geom_tiplab(parse=<span class="string">&quot;emoji&quot;</span>, size=<span class="number">15</span>, vjust=<span class="number">.25</span>) +</span><br><span class="line">  geom_tiplab(aes(label = group), geom=<span class="string">&quot;label&quot;</span>, x=<span class="number">3.5</span>, hjust=<span class="number">.5</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/52.png" class="">

<h2 id="Emoji注释circular-fan树"><a href="#Emoji注释circular-fan树" class="headerlink" title="Emoji注释circular/fan树"></a><code>Emoji</code>注释circular/fan树</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">p &lt;- ggtree(tree, layout = <span class="string">&quot;circular&quot;</span>, size=<span class="number">1</span>) +  </span><br><span class="line">  geom_tiplab(parse=<span class="string">&quot;emoji&quot;</span>, size=<span class="number">10</span>, vjust=<span class="number">.25</span>)</span><br><span class="line">print(p)</span><br><span class="line"></span><br><span class="line"><span class="comment">## fan layout  </span></span><br><span class="line">p2 &lt;- open_tree(p, angle=<span class="number">200</span>) </span><br><span class="line">print(p2)</span><br><span class="line"></span><br><span class="line">p2 %&gt;% rotate_tree(-<span class="number">90</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/53.png" class="">

<h2 id="Emoji注释clades"><a href="#Emoji注释clades" class="headerlink" title="Emoji注释clades"></a><code>Emoji</code>注释clades</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">set.seed(<span class="number">123</span>)</span><br><span class="line">tr &lt;- rtree(<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">ggtree(tr) + xlim(<span class="literal">NA</span>, <span class="number">5.2</span>) +</span><br><span class="line">    geom_cladelabel(node=<span class="number">41</span>, label=<span class="string">&quot;chicken&quot;</span>, parse=<span class="string">&quot;emoji&quot;</span>,</span><br><span class="line">                    fontsize=<span class="number">12</span>, align=<span class="literal">TRUE</span>, colour=<span class="string">&quot;firebrick&quot;</span>) +</span><br><span class="line">    geom_cladelabel(node=<span class="number">53</span>, label=<span class="string">&quot;duck&quot;</span>, parse=<span class="string">&quot;emoji&quot;</span>,</span><br><span class="line">                    fontsize=<span class="number">12</span>, align=<span class="literal">TRUE</span>, colour=<span class="string">&quot;steelblue&quot;</span>) +</span><br><span class="line">    geom_cladelabel(node=<span class="number">48</span>, label=<span class="string">&quot;family&quot;</span>, parse=<span class="string">&quot;emoji&quot;</span>,</span><br><span class="line">                    fontsize=<span class="number">12</span>, align=<span class="literal">TRUE</span>, colour=<span class="string">&quot;darkkhaki&quot;</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/54.png" class="">

<h2 id="AppleColorEmoji"><a href="#AppleColorEmoji" class="headerlink" title="AppleColorEmoji"></a><code>AppleColorEmoji</code></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">library(ggtree)</span><br><span class="line">tree_text &lt;- &quot;(((((cow, (whale, dolphin)), (pig2, boar)), camel), fish), seedling);&quot;</span><br><span class="line">x &lt;- read.tree(text=tree_text)</span><br><span class="line">library(ggimage)</span><br><span class="line">library(gridSVG)</span><br><span class="line">p &lt;-  ggtree(x, size=2) + geom_tiplab(size=20, parse=&#x27;emoji&#x27;) +</span><br><span class="line">    xlim(NA, 7) + ylim(NA, 8.5) +</span><br><span class="line">    geom_phylopic(image=&quot;79ad5f09-cf21-4c89-8e7d-0c82a00ce728&quot;,</span><br><span class="line">                  color=&quot;firebrick&quot;, alpha = .3, size=Inf)</span><br><span class="line"></span><br><span class="line">p</span><br><span class="line">ps = grid.export(&quot;emoji.svg&quot;, addClass=T)</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/55.png" class="">

<h1 id="ggtree可视化其他数据"><a href="#ggtree可视化其他数据" class="headerlink" title="ggtree可视化其他数据"></a><code>ggtree</code>可视化其他数据</h1><p><code>ggtree</code>支持其他的数据类型，比如树状图（更多格式请移步Y叔博客）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">hc &lt;- hclust(dist(mtcars))</span><br><span class="line">hc</span><br><span class="line">clus &lt;- cutree(hc, <span class="number">4</span>)</span><br><span class="line">g &lt;- split(<span class="built_in">names</span>(clus), clus)</span><br><span class="line"></span><br><span class="line">p &lt;- ggtree(hc, linetype=<span class="string">&#x27;dashed&#x27;</span>)</span><br><span class="line">clades &lt;- sapply(g, <span class="keyword">function</span>(n) MRCA(p, n))</span><br><span class="line"></span><br><span class="line">p &lt;- groupClade(p, clades, group_name=<span class="string">&#x27;subtree&#x27;</span>) + aes(color=subtree)</span><br><span class="line"></span><br><span class="line">d &lt;- data.frame(label = <span class="built_in">names</span>(clus), </span><br><span class="line">                cyl = mtcars[<span class="built_in">names</span>(clus), <span class="string">&quot;cyl&quot;</span>])</span><br><span class="line"></span><br><span class="line">p %&lt;+% d + </span><br><span class="line">  layout_dendrogram() + </span><br><span class="line">  geom_tippoint(size=<span class="number">5</span>, shape=<span class="number">21</span>, aes(fill=factor(cyl), x=x+<span class="number">.5</span>), color=<span class="string">&#x27;black&#x27;</span>) + </span><br><span class="line">  geom_tiplab(aes(label=cyl), size=<span class="number">3</span>, hjust=<span class="number">.5</span>, color=<span class="string">&#x27;black&#x27;</span>) +</span><br><span class="line">  geom_tiplab(angle=<span class="number">90</span>, hjust=<span class="number">1</span>, offset=-<span class="number">10</span>, show.legend=<span class="built_in">F</span>) + </span><br><span class="line">  scale_color_brewer(palette=<span class="string">&#x27;Set1&#x27;</span>, breaks=<span class="number">1</span>:<span class="number">4</span>) +</span><br><span class="line">  theme_dendrogram(plot.margin=margin(<span class="number">6</span>,<span class="number">6</span>,<span class="number">80</span>,<span class="number">6</span>)) +</span><br><span class="line">  theme(legend.position=<span class="built_in">c</span>(<span class="number">.9</span>, <span class="number">.6</span>))</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/56.png" class="">

<h1 id="ggtree拓展ggtreeExtra"><a href="#ggtree拓展ggtreeExtra" class="headerlink" title="ggtree拓展ggtreeExtra"></a><code>ggtree</code>拓展<code>ggtreeExtra</code></h1><p><code>ggtreeExtra</code>真的是惊艳到我了，只能献出我的膝盖啊！</p>
<p><code>ggtree</code>的函数<code>geom_facet()</code>只支持<code>rectangular</code>、 <code>roundrect</code>、 <code>ellipse</code> 及 <code>slanted</code> 这4种输出样式，并不支持在<code>circular</code>、<code>fan</code>及<code>radial</code>这几种输出样式的外环上添加图层，为了解决这个问题，Y叔团队开发了新的R包：<code>ggtreeExtra</code>！</p>
<h2 id="添加微生物组丰度"><a href="#添加微生物组丰度" class="headerlink" title="添加微生物组丰度"></a>添加微生物组丰度</h2><p><code>ggtree</code>直接支持<code>phyloseq</code>对象，这个对做微生物的来说，简直就是福音啊！</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">library(ggtreeExtra)</span><br><span class="line">library(ggtree)</span><br><span class="line">library(phyloseq)</span><br><span class="line">library(dplyr)</span><br><span class="line"></span><br><span class="line">data(<span class="string">&quot;GlobalPatterns&quot;</span>)</span><br><span class="line">GP &lt;- GlobalPatterns</span><br><span class="line">GP &lt;- prune_taxa(taxa_sums(GP) &gt; <span class="number">600</span>, GP)</span><br><span class="line">sample_data(GP)$human &lt;- get_variable(GP, <span class="string">&quot;SampleType&quot;</span>) %in%</span><br><span class="line">                              <span class="built_in">c</span>(<span class="string">&quot;Feces&quot;</span>, <span class="string">&quot;Skin&quot;</span>)</span><br><span class="line">mergedGP &lt;- merge_samples(GP, <span class="string">&quot;SampleType&quot;</span>)</span><br><span class="line">mergedGP &lt;- rarefy_even_depth(mergedGP,rngseed=<span class="number">394582</span>)</span><br><span class="line">mergedGP &lt;- tax_glom(mergedGP,<span class="string">&quot;Order&quot;</span>)</span><br><span class="line"></span><br><span class="line">melt_simple &lt;- psmelt(mergedGP) %&gt;%</span><br><span class="line">               filter(Abundance &lt; <span class="number">120</span>) %&gt;%</span><br><span class="line">               select(OTU, val=Abundance)</span><br><span class="line"></span><br><span class="line">p &lt;- ggtree(mergedGP, layout=<span class="string">&quot;fan&quot;</span>, open.angle=<span class="number">10</span>) + </span><br><span class="line">     geom_tippoint(mapping=aes(color=Phylum), </span><br><span class="line">                   size=<span class="number">1.5</span>,</span><br><span class="line">                   show.legend=<span class="literal">FALSE</span>)</span><br><span class="line">p &lt;- rotate_tree(p, -<span class="number">90</span>)</span><br><span class="line"></span><br><span class="line">p &lt;- p +</span><br><span class="line">     geom_fruit(</span><br><span class="line">         data=melt_simple,</span><br><span class="line">         geom=geom_boxplot,</span><br><span class="line">         mapping = aes(</span><br><span class="line">                     y=OTU,</span><br><span class="line">                     x=val,</span><br><span class="line">                     group=label,</span><br><span class="line">                     fill=Phylum,</span><br><span class="line">                   ),</span><br><span class="line">         size=<span class="number">.2</span>,</span><br><span class="line">         outlier.size=<span class="number">0.5</span>,</span><br><span class="line">         outlier.stroke=<span class="number">0.08</span>,</span><br><span class="line">         outlier.shape=<span class="number">21</span>,</span><br><span class="line">         axis.params=<span class="built_in">list</span>(</span><br><span class="line">                         axis       = <span class="string">&quot;x&quot;</span>,</span><br><span class="line">                         text.size  = <span class="number">1.8</span>,</span><br><span class="line">                         hjust      = <span class="number">1</span>,</span><br><span class="line">                         vjust      = <span class="number">0.5</span>,</span><br><span class="line">                         nbreak     = <span class="number">3</span>,</span><br><span class="line">                     ),</span><br><span class="line">         grid.params=<span class="built_in">list</span>()</span><br><span class="line">     ) </span><br><span class="line">     </span><br><span class="line">p &lt;- p +</span><br><span class="line">     scale_fill_discrete(</span><br><span class="line">         name=<span class="string">&quot;Phyla&quot;</span>,</span><br><span class="line">         guide=guide_legend(keywidth=<span class="number">0.8</span>, keyheight=<span class="number">0.8</span>, ncol=<span class="number">1</span>)</span><br><span class="line">     ) +</span><br><span class="line">     theme(</span><br><span class="line">         legend.title=element_text(size=<span class="number">9</span>), <span class="comment"># The title of legend </span></span><br><span class="line">         legend.text=element_text(size=<span class="number">7</span>) <span class="comment"># The label text of legend, the sizes should be adjust with dpi.</span></span><br><span class="line">     )</span><br><span class="line">p</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/57.png" class="">

<h2 id="多维数据添加多个图层"><a href="#多维数据添加多个图层" class="headerlink" title="多维数据添加多个图层"></a>多维数据添加多个图层</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">library(ggtreeExtra)</span><br><span class="line">library(ggtree)</span><br><span class="line">library(treeio)</span><br><span class="line">library(tidytree)</span><br><span class="line">library(ggstar)</span><br><span class="line">library(ggplot2)</span><br><span class="line">library(ggnewscale)</span><br><span class="line"></span><br><span class="line">tree &lt;- read.tree(<span class="string">&quot;data/HMP_tree/hmptree.nwk&quot;</span>)</span><br><span class="line"><span class="comment"># the abundance and types of microbes</span></span><br><span class="line">dat1 &lt;- read.csv(<span class="string">&quot;data/HMP_tree/tippoint_attr.csv&quot;</span>)</span><br><span class="line"><span class="comment"># the abundance of microbes at different body sites.</span></span><br><span class="line">dat2 &lt;- read.csv(<span class="string">&quot;data/HMP_tree/ringheatmap_attr.csv&quot;</span>)</span><br><span class="line"><span class="comment"># the abundance of microbes at the body sites of greatest prevalence.</span></span><br><span class="line">dat3 &lt;- read.csv(<span class="string">&quot;data/HMP_tree/barplot_attr.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># adjust the order</span></span><br><span class="line">dat2$Sites &lt;- factor(dat2$Sites, levels=<span class="built_in">c</span>(<span class="string">&quot;Stool (prevalence)&quot;</span>, <span class="string">&quot;Cheek (prevalence)&quot;</span>,</span><br><span class="line">                                          <span class="string">&quot;Plaque (prevalence)&quot;</span>,<span class="string">&quot;Tongue (prevalence)&quot;</span>,</span><br><span class="line">                                          <span class="string">&quot;Nose (prevalence)&quot;</span>, <span class="string">&quot;Vagina (prevalence)&quot;</span>,</span><br><span class="line">                                          <span class="string">&quot;Skin (prevalence)&quot;</span>))</span><br><span class="line">dat3$Sites &lt;- factor(dat3$Sites, levels=<span class="built_in">c</span>(<span class="string">&quot;Stool (prevalence)&quot;</span>, <span class="string">&quot;Cheek (prevalence)&quot;</span>,</span><br><span class="line">                                          <span class="string">&quot;Plaque (prevalence)&quot;</span>, <span class="string">&quot;Tongue (prevalence)&quot;</span>,</span><br><span class="line">                                          <span class="string">&quot;Nose (prevalence)&quot;</span>, <span class="string">&quot;Vagina (prevalence)&quot;</span>,</span><br><span class="line">                                          <span class="string">&quot;Skin (prevalence)&quot;</span>))</span><br><span class="line"><span class="comment"># extract the clade label information. Because some nodes of tree are annotated to genera,</span></span><br><span class="line"><span class="comment"># which can be displayed with high light using ggtree.</span></span><br><span class="line">nodeids &lt;- nodeid(tree, tree$node.label[nchar(tree$node.label)&gt;<span class="number">4</span>])</span><br><span class="line">nodedf &lt;- data.frame(node=nodeids)</span><br><span class="line">nodelab &lt;- gsub(<span class="string">&quot;[\\.0-9]&quot;</span>, <span class="string">&quot;&quot;</span>, tree$node.label[nchar(tree$node.label)&gt;<span class="number">4</span>])</span><br><span class="line"><span class="comment"># The layers of clade and hightlight</span></span><br><span class="line">poslist &lt;- <span class="built_in">c</span>(<span class="number">1.6</span>, <span class="number">1.4</span>, <span class="number">1.6</span>, <span class="number">0.8</span>, <span class="number">0.1</span>, <span class="number">0.25</span>, <span class="number">1.6</span>, <span class="number">1.6</span>, <span class="number">1.2</span>, <span class="number">0.4</span>,</span><br><span class="line">             <span class="number">1.2</span>, <span class="number">1.8</span>, <span class="number">0.3</span>, <span class="number">0.8</span>, <span class="number">0.4</span>, <span class="number">0.3</span>, <span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">0.6</span>,</span><br><span class="line">             <span class="number">0.3</span>, <span class="number">0.4</span>, <span class="number">0.3</span>)</span><br><span class="line">labdf &lt;- data.frame(node=nodeids, label=nodelab, pos=poslist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The circular layout tree.</span></span><br><span class="line">p &lt;- ggtree(tree, layout=<span class="string">&quot;fan&quot;</span>, size=<span class="number">0.15</span>, open.angle=<span class="number">5</span>) +</span><br><span class="line">     geom_hilight(data=nodedf, mapping=aes(node=node),</span><br><span class="line">                  extendto=<span class="number">6.8</span>, alpha=<span class="number">0.3</span>, fill=<span class="string">&quot;grey&quot;</span>, color=<span class="string">&quot;grey50&quot;</span>,</span><br><span class="line">                  size=<span class="number">0.05</span>) +</span><br><span class="line">     geom_cladelab(data=labdf, </span><br><span class="line">                   mapping=aes(node=node, </span><br><span class="line">                               label=label,</span><br><span class="line">                               offset.text=pos),</span><br><span class="line">                   hjust=<span class="number">0.5</span>,</span><br><span class="line">                   angle=<span class="string">&quot;auto&quot;</span>,</span><br><span class="line">                   barsize=<span class="literal">NA</span>,</span><br><span class="line">                   horizontal=<span class="literal">FALSE</span>, </span><br><span class="line">                   fontsize=<span class="number">1.4</span>,</span><br><span class="line">                   fontface=<span class="string">&quot;italic&quot;</span></span><br><span class="line">                   )</span><br><span class="line"></span><br><span class="line">p &lt;- p %&lt;+% dat1 + geom_star(</span><br><span class="line">                        mapping=aes(fill=Phylum, starshape=Type, size=Size),</span><br><span class="line">                        position=<span class="string">&quot;identity&quot;</span>,starstroke=<span class="number">0.1</span>) +</span><br><span class="line">         scale_fill_manual(values=<span class="built_in">c</span>(<span class="string">&quot;#FFC125&quot;</span>,<span class="string">&quot;#87CEFA&quot;</span>,<span class="string">&quot;#7B68EE&quot;</span>,<span class="string">&quot;#808080&quot;</span>,<span class="string">&quot;#800080&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;#9ACD32&quot;</span>,<span class="string">&quot;#D15FEE&quot;</span>,<span class="string">&quot;#FFC0CB&quot;</span>,<span class="string">&quot;#EE6A50&quot;</span>,<span class="string">&quot;#8DEEEE&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;#006400&quot;</span>,<span class="string">&quot;#800000&quot;</span>,<span class="string">&quot;#B0171F&quot;</span>,<span class="string">&quot;#191970&quot;</span>),</span><br><span class="line">                           guide=guide_legend(keywidth = <span class="number">0.5</span>, keyheight = <span class="number">0.5</span>, order=<span class="number">1</span>,</span><br><span class="line">                                              override.aes=<span class="built_in">list</span>(starshape=<span class="number">15</span>)),</span><br><span class="line">                           na.translate=<span class="literal">FALSE</span>)+</span><br><span class="line">         scale_starshape_manual(values=<span class="built_in">c</span>(<span class="number">15</span>, <span class="number">1</span>),</span><br><span class="line">                                guide=guide_legend(keywidth = <span class="number">0.5</span>, keyheight = <span class="number">0.5</span>, order=<span class="number">2</span>),</span><br><span class="line">                                na.translate=<span class="literal">FALSE</span>)+</span><br><span class="line">         scale_size_continuous(<span class="built_in">range</span> = <span class="built_in">c</span>(<span class="number">1</span>, <span class="number">2.5</span>),</span><br><span class="line">                               guide = guide_legend(keywidth = <span class="number">0.5</span>, keyheight = <span class="number">0.5</span>, order=<span class="number">3</span>,</span><br><span class="line">                                                    override.aes=<span class="built_in">list</span>(starshape=<span class="number">15</span>)))</span><br><span class="line">                                                    </span><br><span class="line">p &lt;- p + new_scale_fill() +</span><br><span class="line">         geom_fruit(data=dat2, geom=geom_tile,</span><br><span class="line">                    mapping=aes(y=ID, x=Sites, alpha=Abundance, fill=Sites),</span><br><span class="line">                    color = <span class="string">&quot;grey50&quot;</span>, offset = <span class="number">0.04</span>,size = <span class="number">0.02</span>)+</span><br><span class="line">         scale_alpha_continuous(<span class="built_in">range</span>=<span class="built_in">c</span>(<span class="number">0</span>, <span class="number">1</span>),</span><br><span class="line">                             guide=guide_legend(keywidth = <span class="number">0.3</span>, keyheight = <span class="number">0.3</span>, order=<span class="number">5</span>)) +</span><br><span class="line">         geom_fruit(data=dat3, geom=geom_bar,</span><br><span class="line">                    mapping=aes(y=ID, x=HigherAbundance, fill=Sites),</span><br><span class="line">                    pwidth=<span class="number">0.38</span>, </span><br><span class="line">                    orientation=<span class="string">&quot;y&quot;</span>, </span><br><span class="line">                    stat=<span class="string">&quot;identity&quot;</span>,</span><br><span class="line">         ) +</span><br><span class="line">         scale_fill_manual(values=<span class="built_in">c</span>(<span class="string">&quot;#0000FF&quot;</span>,<span class="string">&quot;#FFA500&quot;</span>,<span class="string">&quot;#FF0000&quot;</span>,<span class="string">&quot;#800000&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;#006400&quot;</span>,<span class="string">&quot;#800080&quot;</span>,<span class="string">&quot;#696969&quot;</span>),</span><br><span class="line">                           guide=guide_legend(keywidth = <span class="number">0.3</span>, keyheight = <span class="number">0.3</span>, order=<span class="number">4</span>))+</span><br><span class="line">         geom_treescale(fontsize=<span class="number">2</span>, linesize=<span class="number">0.3</span>, x=<span class="number">4.9</span>, y=<span class="number">0.1</span>) +</span><br><span class="line">         theme(legend.position=<span class="built_in">c</span>(<span class="number">0.93</span>, <span class="number">0.5</span>),</span><br><span class="line">               legend.background=element_rect(fill=<span class="literal">NA</span>),</span><br><span class="line">               legend.title=element_text(size=<span class="number">6.5</span>),</span><br><span class="line">               legend.text=element_text(size=<span class="number">4.5</span>),</span><br><span class="line">               legend.spacing.y = unit(<span class="number">0.02</span>, <span class="string">&quot;cm&quot;</span>),</span><br><span class="line">             )</span><br><span class="line">p</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/58.png" class="">

<p>另外一种输出方式：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p + layout_rectangular() + </span><br><span class="line">    theme(legend.position=<span class="built_in">c</span>(<span class="number">.05</span>, <span class="number">.7</span>))</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/59.png" class="">

<h1 id="群体遗学传例子"><a href="#群体遗学传例子" class="headerlink" title="群体遗学传例子"></a>群体遗学传例子</h1><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line">library(ggtree)</span><br><span class="line">library(ggtreeExtra)</span><br><span class="line">library(ggplot2)</span><br><span class="line">library(ggnewscale)</span><br><span class="line">library(dplyr)</span><br><span class="line">library(tidytree)</span><br><span class="line">library(ggstar)</span><br><span class="line"></span><br><span class="line">dat &lt;- read.csv(<span class="string">&quot;data/microreact/Candida_auris/microreact-project-Candidaauris-data.csv&quot;</span>)</span><br><span class="line">tr &lt;- read.tree(<span class="string">&quot;data/microreact/Candida_auris/microreact-project-Candidaauris-tree.nwk&quot;</span>)</span><br><span class="line"></span><br><span class="line">countries &lt;- <span class="built_in">c</span>(<span class="string">&quot;Canada&quot;</span>, <span class="string">&quot;United States&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Colombia&quot;</span>, <span class="string">&quot;Panama&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Venezuela&quot;</span>, <span class="string">&quot;France&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Germany&quot;</span>, <span class="string">&quot;Spain&quot;</span>,</span><br><span class="line">               <span class="string">&quot;UK&quot;</span>, <span class="string">&quot;India&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Israel&quot;</span>, <span class="string">&quot;Pakistan&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Saudi Arabia&quot;</span>, <span class="string">&quot;United Arab Emirates&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Kenya&quot;</span>, <span class="string">&quot;South Africa&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Japan&quot;</span>, <span class="string">&quot;South Korea&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Australia&quot;</span>)</span><br><span class="line"><span class="comment"># For the tip points</span></span><br><span class="line">dat1 &lt;- dat %&gt;% select(<span class="built_in">c</span>(<span class="string">&quot;ID&quot;</span>, <span class="string">&quot;COUNTRY&quot;</span>, <span class="string">&quot;COUNTRY__colour&quot;</span>))</span><br><span class="line">dat1$COUNTRY &lt;- factor(dat1$COUNTRY, levels=countries)</span><br><span class="line">COUNTRYcolors &lt;- dat1[match(countries,dat$COUNTRY),<span class="string">&quot;COUNTRY__colour&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># For the heatmap layer</span></span><br><span class="line">dat2 &lt;- dat %&gt;% select(<span class="built_in">c</span>(<span class="string">&quot;ID&quot;</span>, <span class="string">&quot;FCZ&quot;</span>, <span class="string">&quot;AMB&quot;</span>, <span class="string">&quot;MCF&quot;</span>))</span><br><span class="line">dat2 &lt;- reshape2::melt(dat2,id=<span class="string">&quot;ID&quot;</span>, variable.name=<span class="string">&quot;Antifungal&quot;</span>, value.name=<span class="string">&quot;type&quot;</span>)</span><br><span class="line">dat2$type &lt;- paste(dat2$Antifungal, dat2$type)</span><br><span class="line">dat2$type &lt;- unlist(lapply(dat2$type,</span><br><span class="line">                           <span class="keyword">function</span>(x)ifelse(grepl(<span class="string">&quot;Not_&quot;</span>, x), <span class="string">&quot;Susceptible&quot;</span>, x)))</span><br><span class="line">dat2$Antifungal &lt;- factor(dat2$Antifungal, levels=<span class="built_in">c</span>(<span class="string">&quot;FCZ&quot;</span>, <span class="string">&quot;AMB&quot;</span>, <span class="string">&quot;MCF&quot;</span>))</span><br><span class="line">dat2$type &lt;- factor(dat2$type,</span><br><span class="line">                    levels=<span class="built_in">c</span>(<span class="string">&quot;FCZ Resistant&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;AMB Resistant&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;MCF Resistant&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;Susceptible&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># For the points layer</span></span><br><span class="line">dat3 &lt;- dat %&gt;% select(<span class="built_in">c</span>(<span class="string">&quot;ID&quot;</span>, <span class="string">&quot;ERG11&quot;</span>, <span class="string">&quot;FKS1&quot;</span>)) %&gt;%</span><br><span class="line">        reshape2::melt(id=<span class="string">&quot;ID&quot;</span>, variable.name=<span class="string">&quot;point&quot;</span>, value.name=<span class="string">&quot;mutation&quot;</span>)</span><br><span class="line">dat3$mutation &lt;- paste(dat3$point, dat3$mutation)</span><br><span class="line">dat3$mutation &lt;- unlist(lapply(dat3$mutation, <span class="keyword">function</span>(x)ifelse(grepl(<span class="string">&quot;WT&quot;</span>,x), <span class="literal">NA</span>,x)))</span><br><span class="line">dat3$mutation &lt;- factor(dat3$mutation, levels=<span class="built_in">c</span>(<span class="string">&quot;ERG11 Y132F&quot;</span>, <span class="string">&quot;ERG11 K143R&quot;</span>,</span><br><span class="line">                                                <span class="string">&quot;ERG11 F126L&quot;</span>, <span class="string">&quot;FKS1 S639Y/P/F&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># For the clade group</span></span><br><span class="line">dat4 &lt;- dat %&gt;% select(<span class="built_in">c</span>(<span class="string">&quot;ID&quot;</span>, <span class="string">&quot;CLADE&quot;</span>))</span><br><span class="line">dat4 &lt;- aggregate(.~CLADE, dat4, FUN=paste, collapse=<span class="string">&quot;,&quot;</span>)</span><br><span class="line">clades &lt;- lapply(dat4$ID, <span class="keyword">function</span>(x)&#123;unlist(strsplit(x,split=<span class="string">&quot;,&quot;</span>))&#125;)</span><br><span class="line"><span class="built_in">names</span>(clades) &lt;- dat4$CLADE</span><br><span class="line"></span><br><span class="line">tr &lt;- groupOTU(tr, clades, <span class="string">&quot;Clade&quot;</span>)</span><br><span class="line">Clade &lt;- <span class="literal">NULL</span></span><br><span class="line">p &lt;- ggtree(tr=tr, layout=<span class="string">&quot;fan&quot;</span>, open.angle=<span class="number">15</span>, size=<span class="number">0.2</span>, aes(colour=Clade)) +</span><br><span class="line">     scale_colour_manual(</span><br><span class="line">         values=<span class="built_in">c</span>(<span class="string">&quot;black&quot;</span>,<span class="string">&quot;#69B920&quot;</span>,<span class="string">&quot;#9C2E88&quot;</span>,<span class="string">&quot;#F74B00&quot;</span>,<span class="string">&quot;#60C3DB&quot;</span>),</span><br><span class="line">         labels=<span class="built_in">c</span>(<span class="string">&quot;&quot;</span>,<span class="string">&quot;I&quot;</span>, <span class="string">&quot;II&quot;</span>, <span class="string">&quot;III&quot;</span>, <span class="string">&quot;IV&quot;</span>),</span><br><span class="line">         guide=guide_legend(keywidth=<span class="number">0.5</span>,</span><br><span class="line">                            keyheight=<span class="number">0.5</span>,</span><br><span class="line">                            order=<span class="number">1</span>,</span><br><span class="line">                            override.aes=<span class="built_in">list</span>(linetype=<span class="built_in">c</span>(<span class="string">&quot;0&quot;</span>=<span class="literal">NA</span>,</span><br><span class="line">                                                         <span class="string">&quot;Clade1&quot;</span>=<span class="number">1</span>,</span><br><span class="line">                                                         <span class="string">&quot;Clade2&quot;</span>=<span class="number">1</span>,</span><br><span class="line">                                                         <span class="string">&quot;Clade3&quot;</span>=<span class="number">1</span>,</span><br><span class="line">                                                         <span class="string">&quot;Clade4&quot;</span>=<span class="number">1</span></span><br><span class="line">                                                        )</span><br><span class="line">                                             )</span><br><span class="line">                           )</span><br><span class="line">     ) + </span><br><span class="line">     new_scale_colour()</span><br><span class="line"></span><br><span class="line">p1 &lt;- p %&lt;+% dat1 +</span><br><span class="line">     geom_tippoint(aes(colour=COUNTRY),</span><br><span class="line">                   alpha=<span class="number">0</span>) +</span><br><span class="line">     geom_tiplab(aes(colour=COUNTRY),</span><br><span class="line">                   align=<span class="literal">TRUE</span>,</span><br><span class="line">                   linetype=<span class="number">3</span>,</span><br><span class="line">                   size=<span class="number">1</span>,</span><br><span class="line">                   linesize=<span class="number">0.2</span>,</span><br><span class="line">                   show.legend=<span class="literal">FALSE</span></span><br><span class="line">                   ) +</span><br><span class="line">     scale_colour_manual(</span><br><span class="line">         name=<span class="string">&quot;Country labels&quot;</span>,</span><br><span class="line">         values=COUNTRYcolors,</span><br><span class="line">         guide=guide_legend(keywidth=<span class="number">0.5</span>,</span><br><span class="line">                            keyheight=<span class="number">0.5</span>,</span><br><span class="line">                            order=<span class="number">2</span>,</span><br><span class="line">                            override.aes=<span class="built_in">list</span>(size=<span class="number">2</span>,alpha=<span class="number">1</span>))</span><br><span class="line">     )</span><br><span class="line"></span><br><span class="line">p2 &lt;- p1 +</span><br><span class="line">      geom_fruit(</span><br><span class="line">          data=dat2,</span><br><span class="line">          geom=geom_tile,</span><br><span class="line">          mapping=aes(x=Antifungal, y=ID, fill=type),</span><br><span class="line">          width=<span class="number">0.1</span>,</span><br><span class="line">          color=<span class="string">&quot;white&quot;</span>,</span><br><span class="line">          pwidth=<span class="number">0.1</span>,</span><br><span class="line">          offset=<span class="number">0.15</span></span><br><span class="line">      ) +</span><br><span class="line">      scale_fill_manual(</span><br><span class="line">           name=<span class="string">&quot;Antifungal susceptibility&quot;</span>,</span><br><span class="line">           values=<span class="built_in">c</span>(<span class="string">&quot;#595959&quot;</span>, <span class="string">&quot;#B30000&quot;</span>, <span class="string">&quot;#020099&quot;</span>, <span class="string">&quot;#E6E6E6&quot;</span>),</span><br><span class="line">           na.translate=<span class="literal">FALSE</span>,</span><br><span class="line">           guide=guide_legend(keywidth=<span class="number">0.5</span>,</span><br><span class="line">                              keyheight=<span class="number">0.5</span>,</span><br><span class="line">                              order=<span class="number">3</span></span><br><span class="line">                             )</span><br><span class="line">      ) +</span><br><span class="line">      new_scale_fill()</span><br><span class="line"></span><br><span class="line">p3 &lt;- p2 +</span><br><span class="line">      geom_fruit(</span><br><span class="line">          data=dat3,</span><br><span class="line">          geom=geom_star,</span><br><span class="line">          mapping=aes(x=mutation, y=ID, fill=mutation, starshape=point),</span><br><span class="line">          size=<span class="number">1</span>,</span><br><span class="line">          starstroke=<span class="number">0</span>,</span><br><span class="line">          pwidth=<span class="number">0.1</span>,</span><br><span class="line">          inherit.aes = <span class="literal">FALSE</span>,</span><br><span class="line">          grid.params=<span class="built_in">list</span>(</span><br><span class="line">                          linetype=<span class="number">3</span>,</span><br><span class="line">                          size=<span class="number">0.2</span></span><br><span class="line">                      )</span><br><span class="line"></span><br><span class="line">      ) +</span><br><span class="line">      scale_fill_manual(</span><br><span class="line">          name=<span class="string">&quot;Point mutations&quot;</span>,</span><br><span class="line">          values=<span class="built_in">c</span>(<span class="string">&quot;#329901&quot;</span>, <span class="string">&quot;#0600FF&quot;</span>, <span class="string">&quot;#FF0100&quot;</span>, <span class="string">&quot;#9900CC&quot;</span>),</span><br><span class="line">          guide=guide_legend(keywidth=<span class="number">0.5</span>, keyheight=<span class="number">0.5</span>, order=<span class="number">4</span>,</span><br><span class="line">                             override.aes=<span class="built_in">list</span>(starshape=<span class="built_in">c</span>(<span class="string">&quot;ERG11 Y132F&quot;</span>=<span class="number">15</span>,</span><br><span class="line">                                                           <span class="string">&quot;ERG11 K143R&quot;</span>=<span class="number">15</span>,</span><br><span class="line">                                                           <span class="string">&quot;ERG11 F126L&quot;</span>=<span class="number">15</span>,</span><br><span class="line">                                                           <span class="string">&quot;FKS1 S639Y/P/F&quot;</span>=<span class="number">1</span>),</span><br><span class="line">                                               size=<span class="number">2</span>)</span><br><span class="line">                            ),</span><br><span class="line">          na.translate=<span class="literal">FALSE</span>,</span><br><span class="line">      ) +</span><br><span class="line">      scale_starshape_manual(</span><br><span class="line">          values=<span class="built_in">c</span>(<span class="number">15</span>, <span class="number">1</span>),</span><br><span class="line">          guide=<span class="string">&quot;none&quot;</span></span><br><span class="line">      ) +</span><br><span class="line">      theme(</span><br><span class="line">          legend.background=element_rect(fill=<span class="literal">NA</span>),</span><br><span class="line">          legend.title=element_text(size=<span class="number">7</span>), <span class="comment"># The size should be adjusted with different devout.</span></span><br><span class="line">          legend.text=element_text(size=<span class="number">5.5</span>),</span><br><span class="line">          legend.spacing.y = unit(<span class="number">0.02</span>, <span class="string">&quot;cm&quot;</span>)</span><br><span class="line">      )</span><br><span class="line">p3</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/60.png" class="">

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">library(ggtreeExtra)</span><br><span class="line">library(ggtree)</span><br><span class="line">library(ggplot2)</span><br><span class="line">library(ggnewscale)</span><br><span class="line">library(treeio)</span><br><span class="line">library(tidytree)</span><br><span class="line">library(dplyr)</span><br><span class="line">library(ggstar)</span><br><span class="line"></span><br><span class="line">tr &lt;- read.tree(<span class="string">&quot;data/microreact/Salmonella_Typhi/microreact-project-NJIDqgsS-tree.nwk&quot;</span>)</span><br><span class="line"></span><br><span class="line">metada &lt;- read.csv(<span class="string">&quot;data/microreact/Salmonella_Typhi/microreact-project-NJIDqgsS-data.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line">metadata &lt;- metada %&gt;%</span><br><span class="line">            select(<span class="built_in">c</span>(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;country&quot;</span>, <span class="string">&quot;country__colour&quot;</span>, <span class="string">&quot;year&quot;</span>, <span class="string">&quot;year__colour&quot;</span>, <span class="string">&quot;haplotype&quot;</span>))</span><br><span class="line">metadata$haplotype &lt;- unlist(lapply(metadata$haplotype, <span class="keyword">function</span>(x)ifelse(nchar(x)&gt;<span class="number">0</span>,x,<span class="literal">NA</span>)))</span><br><span class="line"></span><br><span class="line">countrycolors &lt;- metada %&gt;%</span><br><span class="line">                 select(<span class="built_in">c</span>(<span class="string">&quot;country&quot;</span>, <span class="string">&quot;country__colour&quot;</span>)) %&gt;%</span><br><span class="line">                 distinct()</span><br><span class="line"></span><br><span class="line">yearcolors &lt;- metada %&gt;%</span><br><span class="line">              select(<span class="built_in">c</span>(<span class="string">&quot;year&quot;</span>, <span class="string">&quot;year__colour&quot;</span>)) %&gt;%</span><br><span class="line">              distinct()</span><br><span class="line">yearcolors &lt;- yearcolors[order(yearcolors$year, decreasing=<span class="literal">TRUE</span>),]</span><br><span class="line"></span><br><span class="line">metadata$country &lt;- factor(metadata$country, levels=countrycolors$country)</span><br><span class="line">metadata$year &lt;- factor(metadata$year, levels=yearcolors$year)</span><br><span class="line"></span><br><span class="line">p &lt;- ggtree(tr, layout=<span class="string">&quot;fan&quot;</span>, open.angle=<span class="number">15</span>, size=<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">p &lt;- p %&lt;+% metadata</span><br><span class="line"></span><br><span class="line">p1 &lt;-p +</span><br><span class="line">     geom_tippoint(</span><br><span class="line">         mapping=aes(colour=country),</span><br><span class="line">         size=<span class="number">1.5</span>,</span><br><span class="line">         stroke=<span class="number">0</span>,</span><br><span class="line">         alpha=<span class="number">0.4</span></span><br><span class="line">     ) +</span><br><span class="line">     scale_colour_manual(</span><br><span class="line">         name=<span class="string">&quot;Country&quot;</span>,</span><br><span class="line">         values=countrycolors$country__colour,</span><br><span class="line">         guide=guide_legend(keywidth=<span class="number">0.3</span>,</span><br><span class="line">                            keyheight=<span class="number">0.3</span>,</span><br><span class="line">                            ncol=<span class="number">2</span>,</span><br><span class="line">                            override.aes=<span class="built_in">list</span>(size=<span class="number">2</span>,alpha=<span class="number">1</span>),</span><br><span class="line">                            order=<span class="number">1</span>)</span><br><span class="line">     ) +</span><br><span class="line">     theme(</span><br><span class="line">         legend.title=element_text(size=<span class="number">5</span>),</span><br><span class="line">         legend.text=element_text(size=<span class="number">4</span>),</span><br><span class="line">         legend.spacing.y = unit(<span class="number">0.02</span>, <span class="string">&quot;cm&quot;</span>)</span><br><span class="line">     )</span><br><span class="line"></span><br><span class="line">p2 &lt;-p1 +</span><br><span class="line">     geom_fruit(</span><br><span class="line">         geom=geom_star,</span><br><span class="line">         mapping=aes(fill=haplotype),</span><br><span class="line">         starshape=<span class="number">26</span>,</span><br><span class="line">         color=<span class="literal">NA</span>,</span><br><span class="line">         size=<span class="number">2</span>,</span><br><span class="line">         starstroke=<span class="number">0</span>,</span><br><span class="line">         offset=<span class="number">0</span>,</span><br><span class="line">     ) +</span><br><span class="line">     scale_fill_manual(</span><br><span class="line">         name=<span class="string">&quot;Haplotype&quot;</span>,</span><br><span class="line">         values=<span class="built_in">c</span>(<span class="string">&quot;red&quot;</span>),</span><br><span class="line">         guide=guide_legend(</span><br><span class="line">                   keywidth=<span class="number">0.3</span>,</span><br><span class="line">                   keyheight=<span class="number">0.3</span>,</span><br><span class="line">                   order=<span class="number">3</span></span><br><span class="line">               ),</span><br><span class="line">         na.translate=<span class="literal">FALSE</span></span><br><span class="line">     )</span><br><span class="line"></span><br><span class="line">p3 &lt;-p2 +</span><br><span class="line">     new_scale_fill() +</span><br><span class="line">     geom_fruit(</span><br><span class="line">         geom=geom_tile,</span><br><span class="line">         mapping=aes(fill=year),</span><br><span class="line">         width=<span class="number">0.002</span>,</span><br><span class="line">         offset=<span class="number">0.1</span></span><br><span class="line">     ) +</span><br><span class="line">     scale_fill_manual(</span><br><span class="line">         name=<span class="string">&quot;Year&quot;</span>,</span><br><span class="line">         values=yearcolors$year__colour,</span><br><span class="line">         guide=guide_legend(keywidth=<span class="number">0.3</span>, keyheight=<span class="number">0.3</span>, ncol=<span class="number">2</span>, order=<span class="number">2</span>)</span><br><span class="line">     ) +</span><br><span class="line">     theme(</span><br><span class="line">           legend.title=element_text(size=<span class="number">6</span>), <span class="comment"># The size should be adjusted with the different devout.</span></span><br><span class="line">           legend.text=element_text(size=<span class="number">4.5</span>),</span><br><span class="line">           legend.spacing.y = unit(<span class="number">0.02</span>, <span class="string">&quot;cm&quot;</span>)</span><br><span class="line">           )</span><br><span class="line">p3</span><br></pre></td></tr></table></figure>

<img src="/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/61.png" class="">

<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><blockquote>
<p>[1]. Yu G, Smith D K, Zhu H, et al. ggtree: an R package for visualization and annotation of phylogenetic trees with their covariates and other associated data[J]. <em><strong>Methods in Ecology and Evolution</strong></em>, 2017, 8(1): 28-36.</p>
<p>[2]. <a target="_blank" rel="noopener" href="https://yulab-smu.top/treedata-book/index.html">https://yulab-smu.top/treedata-book/index.html</a></p>
<p>[3]. <a target="_blank" rel="noopener" href="https://cosx.org/2015/11/to-achieve-the-visualization-and-annotation-of-evolutionary-tree-using-ggtree/">https://cosx.org/2015/11/to-achieve-the-visualization-and-annotation-of-evolutionary-tree-using-ggtree/</a></p>
<p>[4]. <a target="_blank" rel="noopener" href="https://yulab-smu.top/treedata-book/chapter1.html">https://yulab-smu.top/treedata-book/chapter1.html</a></p>
<p>[5]. Wang L G, Lam T T Y, Xu S, et al. Treeio: an R package for phylogenetic tree input and output with richly annotated and associated data[J]. Molecular biology and evolution, 2020, 37(2): 599-603.</p>
<p>[6]. <a target="_blank" rel="noopener" href="https://github.com/YuLab-SMU/tidytree">https://github.com/YuLab-SMU/tidytree</a></p>
</blockquote>
<p>交流请联系：</p>
<blockquote>
<blockquote>
<p>💌<a href="mailto:&#108;&#105;&#x78;&#x69;&#x61;&#110;&#x67;&#x31;&#49;&#x37;&#x34;&#50;&#51;&#64;&#x67;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#x6d;">&#108;&#105;&#x78;&#x69;&#x61;&#110;&#x67;&#x31;&#49;&#x37;&#x34;&#50;&#51;&#64;&#x67;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#x6d;</a></p>
</blockquote>
<blockquote>
<p>💌<a href="mailto:&#x6c;&#105;&#x78;&#105;&#x61;&#110;&#103;&#49;&#49;&#55;&#52;&#x32;&#51;&#x40;&#102;&#x6f;&#120;&#x6d;&#97;&#105;&#108;&#46;&#x63;&#111;&#109;">&#x6c;&#105;&#x78;&#105;&#x61;&#110;&#103;&#49;&#49;&#55;&#52;&#x32;&#51;&#x40;&#102;&#x6f;&#120;&#x6d;&#97;&#105;&#108;&#46;&#x63;&#111;&#109;</a></p>
</blockquote>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">小蓝哥</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">http://example.com/2021/02/15/ggtree%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/R%E8%AF%AD%E8%A8%80/">R语言</a></div><div class="post_share"><div class="social-share" data-image="/img/cover/ggtree.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> Donate</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/02/26/Coursera%E5%8A%A9%E5%AD%A6%E9%87%91%E7%94%B3%E8%AF%B7%E6%A8%A1%E6%9D%BF/"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Coursera助学金申请模板</div></div></a></div><div class="next-post pull-right"><a href="/2021/02/12/%E6%96%B0%E5%B8%8C%E6%9C%9B%E2%80%94%E9%87%8E%E7%94%9F%EF%BC%88%E8%BF%91%E7%BC%98%EF%BC%89%E7%A7%8D%E8%B4%A8%E8%B5%84%E6%BA%90/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">新希望—野生（近缘）种质资源</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2020/12/23/data-table%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="data.table学习笔记"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-23</div><div class="title">data.table学习笔记</div></div></a></div><div><a href="/2021/03/31/clusterProfiler%E5%81%9A%E5%AF%8C%E9%9B%86%E5%88%86%E6%9E%90/" title="clusterProfiler做富集分析"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-31</div><div class="title">clusterProfiler做富集分析</div></div></a></div><div><a href="/2021/07/06/GENIE3%E6%9E%84%E5%BB%BA%E5%9F%BA%E5%9B%A0%E8%B0%83%E6%8E%A7%E7%BD%91%E7%BB%9C/" title="GENIE3构建基因调控网络"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-06</div><div class="title">GENIE3构建基因调控网络</div></div></a></div><div><a href="/2020/12/21/ggplot2%E5%88%86%E9%9D%A2%E5%A1%AB%E5%85%85%E8%89%B2%E4%B8%8E%E5%AD%97%E4%BD%93%E5%A4%A7%E5%B0%8F/" title="ggplot2分面填充色与字体大小"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-21</div><div class="title">ggplot2分面填充色与字体大小</div></div></a></div><div><a href="/2020/12/30/ggplot2%E5%9D%A1%E5%BA%A6%E5%9B%BE/" title="ggplot2坡度图"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-30</div><div class="title">ggplot2坡度图</div></div></a></div><div><a href="/2020/12/16/ggplot2%E7%94%BB%E7%AE%AD%E5%A4%B4/" title="ggplot2画箭头"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-16</div><div class="title">ggplot2画箭头</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="toc-number">1.</span> <span class="toc-text">写在前面</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E8%BF%9B%E5%8C%96%E6%A0%91"><span class="toc-number">2.</span> <span class="toc-text">关于进化树</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E5%8C%96%E6%A0%91%E6%80%8E%E4%B9%88%E7%9C%8B"><span class="toc-number">2.1.</span> <span class="toc-text">进化树怎么看</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E5%8C%96%E6%A0%91%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">进化树数据格式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Newick%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.2.1.</span> <span class="toc-text">Newick格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NEXUS%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.2.2.</span> <span class="toc-text">NEXUS格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.2.3.</span> <span class="toc-text">其他格式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9B%E5%8C%96%E6%A0%91%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">进化树数据处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#phylo%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.1.</span> <span class="toc-text">phylo对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#treedata%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.2.</span> <span class="toc-text">treedata对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%91%E6%96%87%E4%BB%B6%E8%9E%8D%E5%90%88"><span class="toc-number">3.3.</span> <span class="toc-text">树文件融合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E5%A4%96%E9%83%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">3.4.</span> <span class="toc-text">链接外部数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%89%BE%E5%88%B0%E6%83%B3%E8%A6%81%E7%9A%84node"><span class="toc-number">3.5.</span> <span class="toc-text">如何找到想要的node</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BB%84"><span class="toc-number">3.6.</span> <span class="toc-text">分组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#groupClade"><span class="toc-number">3.6.1.</span> <span class="toc-text">groupClade</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#groupOTU"><span class="toc-number">3.6.2.</span> <span class="toc-text">groupOTU</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E6%A0%87%E5%87%86%E5%8C%96%E5%88%86%E6%94%AF"><span class="toc-number">3.7.</span> <span class="toc-text">重新标准化分支</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E9%9B%86%E6%93%8D%E4%BD%9C"><span class="toc-number">3.8.</span> <span class="toc-text">子集操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%A0%91%E4%B8%AD%E9%99%A4%E5%8E%BBtips"><span class="toc-number">3.8.1.</span> <span class="toc-text">从树中除去tips</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AEtips%E5%8F%96%E5%AD%90%E9%9B%86"><span class="toc-number">3.8.2.</span> <span class="toc-text">根据tips取子集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%86%85%E9%83%A8%E8%8A%82%E7%82%B9%E7%BC%96%E5%8F%B7%E5%8F%96%E5%AD%90%E9%9B%86"><span class="toc-number">3.8.3.</span> <span class="toc-text">根据内部节点编号取子集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">3.9.</span> <span class="toc-text">导出数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9B%E5%8C%96%E6%A0%91%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text">进化树可视化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%96%B9%E6%B3%95"><span class="toc-number">4.1.</span> <span class="toc-text">基础方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E6%A0%B7%E5%BC%8F"><span class="toc-number">4.2.</span> <span class="toc-text">输出样式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E7%9B%B8%E5%85%B3%E5%85%83%E7%B4%A0"><span class="toc-number">4.3.</span> <span class="toc-text">展示相关元素</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E8%BF%9B%E5%8C%96%E8%B7%9D%E7%A6%BB"><span class="toc-number">4.3.1.</span> <span class="toc-text">展示进化距离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA-nodes-tips"><span class="toc-number">4.3.2.</span> <span class="toc-text">展示 nodes&#x2F;tips</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BAtips%E7%9A%84%E6%A0%87%E7%AD%BE"><span class="toc-number">4.3.3.</span> <span class="toc-text">展示tips的标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E6%A0%B9%E8%8A%82%E7%82%B9"><span class="toc-number">4.3.4.</span> <span class="toc-text">展示根节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E8%89%B2"><span class="toc-number">4.3.5.</span> <span class="toc-text">上色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%A0%91%E8%BF%9B%E8%A1%8C%E9%87%8D%E6%96%B0%E6%A0%87%E5%87%86%E5%8C%96"><span class="toc-number">4.3.6.</span> <span class="toc-text">对树进行重新标准化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E8%89%B2"><span class="toc-number">4.3.7.</span> <span class="toc-text">背景色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%BB%BA%E6%A0%91"><span class="toc-number">4.3.8.</span> <span class="toc-text">批量建树</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9B%E5%8C%96%E6%A0%91%E6%B3%A8%E9%87%8A"><span class="toc-number">5.</span> <span class="toc-text">进化树注释</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">5.1.</span> <span class="toc-text">基本用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#clade%E6%B3%A8%E9%87%8A"><span class="toc-number">5.2.</span> <span class="toc-text">clade注释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E9%AB%98%E4%BA%AE"><span class="toc-number">5.3.</span> <span class="toc-text">局部高亮</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E4%BA%AE%E4%B8%8D%E5%90%8C%E5%88%86%E7%BB%84"><span class="toc-number">5.4.</span> <span class="toc-text">高亮不同分组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B7%E5%93%81%E8%BF%9E%E6%8E%A5"><span class="toc-number">5.5.</span> <span class="toc-text">样品连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Uncertainty-of-evolutionary-inference"><span class="toc-number">5.6.</span> <span class="toc-text">Uncertainty of evolutionary inference</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%BD%AF%E4%BB%B6%E8%BE%93%E5%87%BA%E7%9A%84%E7%BB%93%E6%9E%9C"><span class="toc-number">5.7.</span> <span class="toc-text">其他软件输出的结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BE%E5%A4%A7%E7%89%B9%E5%AE%9A%E5%8C%BA%E5%9F%9F"><span class="toc-number">5.8.</span> <span class="toc-text">放大特定区域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E5%8C%96%E9%80%89%E4%B8%AD%E7%9A%84clade"><span class="toc-number">5.9.</span> <span class="toc-text">标准化选中的clade</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%90%E8%97%8F-%E5%B1%95%E7%A4%BA%E6%9F%90%E4%B8%AAclade"><span class="toc-number">5.10.</span> <span class="toc-text">隐藏&#x2F;展示某个clade</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E4%B8%89%E8%A7%92%E5%BD%A2%E9%9A%90%E8%97%8F-%E5%B1%95%E7%A4%BA%E6%9F%90%E4%B8%AAclade"><span class="toc-number">5.11.</span> <span class="toc-text">利用三角形隐藏&#x2F;展示某个clade</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BB%84Taxa"><span class="toc-number">5.12.</span> <span class="toc-text">分组Taxa</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%8B%E8%BD%ACclade"><span class="toc-number">5.13.</span> <span class="toc-text">旋转clade</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E6%95%B0%E6%8D%AEmapping%E5%88%B0%E6%A0%91%E4%B8%8A"><span class="toc-number">5.14.</span> <span class="toc-text">外部数据mapping到树上</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86SNP%E6%95%B0%E6%8D%AE%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%A0%91%E4%B8%8A"><span class="toc-number">5.15.</span> <span class="toc-text">将SNP数据添加到树上</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E8%81%94%E7%9F%A9%E9%98%B5"><span class="toc-number">5.16.</span> <span class="toc-text">关联矩阵</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E8%81%94%E5%A4%9A%E4%B8%AA%E7%9F%A9%E9%98%B5"><span class="toc-number">5.17.</span> <span class="toc-text">关联多个矩阵</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E5%BA%8F%E5%88%97%E6%AF%94%E5%AF%B9%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">5.18.</span> <span class="toc-text">多序列比对可视化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%BC%E5%9B%BE"><span class="toc-number">5.19.</span> <span class="toc-text">拼图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%B3%A8%E9%87%8A"><span class="toc-number">5.20.</span> <span class="toc-text">图片注释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E6%A0%87%EF%BC%88%E5%89%AA%E5%BD%B1%EF%BC%89%E6%B3%A8%E9%87%8A"><span class="toc-number">5.21.</span> <span class="toc-text">图标（剪影）注释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AD%90%E5%9B%BE%E8%BF%9B%E8%A1%8C%E6%B3%A8%E9%87%8A"><span class="toc-number">5.22.</span> <span class="toc-text">使用子图进行注释</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E5%BD%A2%E5%9B%BE%E6%B3%A8%E9%87%8A"><span class="toc-number">5.22.1.</span> <span class="toc-text">条形图注释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A5%BC%E5%9B%BE%E6%B3%A8%E9%87%8A"><span class="toc-number">5.22.2.</span> <span class="toc-text">饼图注释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%A7%8D%E5%9B%BE%E5%83%8F%E7%BB%84%E5%90%88%E6%B3%A8%E9%87%8A"><span class="toc-number">5.22.3.</span> <span class="toc-text">多种图像组合注释</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phylomoji%E6%B3%A8%E9%87%8A"><span class="toc-number">5.23.</span> <span class="toc-text">Phylomoji注释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Emoji%E6%B3%A8%E9%87%8Acircular-fan%E6%A0%91"><span class="toc-number">5.24.</span> <span class="toc-text">Emoji注释circular&#x2F;fan树</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Emoji%E6%B3%A8%E9%87%8Aclades"><span class="toc-number">5.25.</span> <span class="toc-text">Emoji注释clades</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AppleColorEmoji"><span class="toc-number">5.26.</span> <span class="toc-text">AppleColorEmoji</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ggtree%E5%8F%AF%E8%A7%86%E5%8C%96%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE"><span class="toc-number">6.</span> <span class="toc-text">ggtree可视化其他数据</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ggtree%E6%8B%93%E5%B1%95ggtreeExtra"><span class="toc-number">7.</span> <span class="toc-text">ggtree拓展ggtreeExtra</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%BE%AE%E7%94%9F%E7%89%A9%E7%BB%84%E4%B8%B0%E5%BA%A6"><span class="toc-number">7.1.</span> <span class="toc-text">添加微生物组丰度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%BB%B4%E6%95%B0%E6%8D%AE%E6%B7%BB%E5%8A%A0%E5%A4%9A%E4%B8%AA%E5%9B%BE%E5%B1%82"><span class="toc-number">7.2.</span> <span class="toc-text">多维数据添加多个图层</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BE%A4%E4%BD%93%E9%81%97%E5%AD%A6%E4%BC%A0%E4%BE%8B%E5%AD%90"><span class="toc-number">8.</span> <span class="toc-text">群体遗学传例子</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">9.</span> <span class="toc-text">参考文献</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/img/cover/ggtree.png')"><div id="footer-wrap"><div class="copyright">&copy;2021 By 小蓝哥</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="Increase font size"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="Decrease font size"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional Chinese And Simplified Chinese">簡</button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>